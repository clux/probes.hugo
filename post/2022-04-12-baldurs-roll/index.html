<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Baldur's Gate: Multinomial Edition - probes</title>
<meta name=description content="Auto-rolling and getting nerd sniped before venturing forth">
<meta name=author content="clux"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"probes","url":"https:\/\/clux.dev\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/clux.dev\/"}</script>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/clux.dev\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/clux.dev\/post\/2022-04-12-baldurs-roll\/","name":"Baldur\u0027S gate multinomial edition"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"clux"},"headline":"Baldur\u0027s Gate: Multinomial Edition","description":"In a brief bout of escapism from the world and responsibilities, I booted up Baldur\u0026rsquo;s Gate 2 with my brother. It\u0026rsquo;s an amazing game, once you have figured out how to roll your character.\nFor today\u0026rsquo;s installment; rather than telling you about the game, let\u0026rsquo;s talk about the maths behind rolling a 2e character for BG2, and then running simulations with weird X-based linux tools.\n","inLanguage":"en","wordCount":5514,"datePublished":"2022-04-12T00:00:00","dateModified":"2022-04-12T00:00:00","image":"https:\/\/clux.dev\/","keywords":["math"],"mainEntityOfPage":"https:\/\/clux.dev\/post\/2022-04-12-baldurs-roll\/","publisher":{"@type":"Organization","name":"https:\/\/clux.dev\/","logo":{"@type":"ImageObject","url":"https:\/\/clux.dev\/","height":60,"width":60}}}</script>
<meta property="og:title" content="Baldur's Gate: Multinomial Edition">
<meta property="og:description" content="Auto-rolling and getting nerd sniped before venturing forth">
<meta property="og:url" content="https://clux.dev/post/2022-04-12-baldurs-roll/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="probes">
<meta name=twitter:title content="Baldur's Gate: Multinomial Edition">
<meta name=twitter:description content="Auto-rolling and getting nerd sniped before venturing forth">
<meta name=twitter:card content="summary">
<meta name=generator content="Hugo 0.87.0">
<link rel=alternate href=https://clux.dev/index.xml type=application/rss+xml title=probes><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous>
<link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous>
<link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://clux.dev/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://clux.dev/css/syntax.css><link rel=stylesheet href=https://clux.dev/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous>
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top navbar-custom">
<div class=container-fluid>
<div class=navbar-header>
<button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://clux.dev/>probes</a>
</div>
<div class="collapse navbar-collapse" id=main-navbar>
<ul class="nav navbar-nav navbar-right">
<li>
<a title=Blog href=https://clux.dev/>Blog</a>
</li>
<li>
<a title=About href=https://clux.dev/page/about/>About</a>
</li>
<li>
<a title=Tags href=https://clux.dev/tags>Tags</a>
</li>
</ul>
</div>
</div>
</nav>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<header class=header-section>
<div class="intro-header no-img">
<div class=container>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<div class=post-heading>
<h1>Baldur's Gate: Multinomial Edition</h1>
<h2 class=post-subheading>Auto-rolling and getting nerd sniped before venturing forth</h2>
<span class=post-meta>
<i class="fas fa-calendar"></i>&nbsp;Posted on April 12, 2022
&nbsp;(Last modified on April 14, 2022)
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;clux
</span>
</div>
</div>
</div>
</div>
</div>
</header>
<div class=container role=main>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<article role=main class=blog-post>
<p>In a <del>brief</del> bout of escapism from the world and responsibilities, I booted up <a href=https://store.steampowered.com/app/257350/Baldurs_Gate_II_Enhanced_Edition/>Baldur&rsquo;s Gate 2</a> with my brother. It&rsquo;s an amazing game, once you have figured out how to <strong><a href="https://old.reddit.com/r/baldursgate/search?q=roll&restrict_sr=on">roll</a></strong> your character.</p>
<p>For today&rsquo;s installment; rather than telling you about the game, let&rsquo;s talk about the <strong>maths</strong> behind rolling a <code>2e</code> character for <code>BG2</code>, and then running simulations with weird <code>X</code>-based linux tools.</p>
<script src=https://cdn.plot.ly/plotly-2.9.0.min.js></script>
<h2 id=rolling-a-character>Rolling a character</h2>
<p>The <code>BG2</code> character generation mechanics is almost entirely based on the rules from <code>AD&D 2e</code>. You get <code>6</code> ability scores, and each ability score is rolled as the sum of <code>3d6</code>.</p>
<blockquote>
<p>Probablistically; this <strong>should</strong> give you a character with an expected <code>63</code> total ability points (as a result of rolling <code>18d6</code>).</p>
</blockquote>
<p>Mechanically, you are in this screen:</p>
<p><img src=https://clux.dev/imgs/bg/rolling.png alt="bg2 stat rolling screen"></p>
<p>&mldr;and they have given you a <code>reroll</code> button.</p>
<p>It&rsquo;s a strange design idea to port the rolling mechanics from <code>d&d</code> into this game. In a normal campaign you&rsquo;d usually get one chance rolling, but here, there&rsquo;s no downside to keeping going; encouraging excessive time investment (the irony in writing a blog post on this is not lost on me). <small>The character creation in BG2 would probably have been less perfection focused if they&rsquo;d gone for something like <a href=https://chicken-dinner.com/5e/5e-point-buy.html>5e point buy</a>.</small></p>
<p>Anyway, <strong>suppose</strong> you want learn how to automate this, or you just want to think about combinatorics, multinomials, and weird <code>X</code> tools for a while, then this is the right place. You will also figure out <strong>how long it&rsquo;s expected to take</strong> to roll high.</p>
<blockquote>
<p>HINT: ..it&rsquo;s less time than it took to write this blogpost</p>
</blockquote>
<h2 id=disclaimer>Disclaimer</h2>
<p>Using the script used herein to achieve higher rolls than you have patience for, is on some level; cheating. That said, it&rsquo;s a fairly pointless effort:</p>
<ul>
<li>this is an <a href=https://en.wikipedia.org/wiki/Baldur%27s_Gate_II:_Shadows_of_Amn>old</a>, unranked rpg with difficulty settings</li>
<li>having <a href=https://tvtropes.org/pmwiki/pmwiki.php/Main/DumpStat>dump stats</a> is not heavily penalized in the game</li>
<li>early items nullify effects of common dump stats (<a href=https://baldursgate.fandom.com/wiki/Girdle_of_Hill_Giant_Strength>19 STR girdle</a> or <a href=https://baldursgate.fandom.com/wiki/Ring_of_Human_Influence>18 CHA ring</a>)</li>
<li>you can get <a href="https://www.youtube.com/watch?v=5dDmh98lmkA">max stats in 20 minutes</a> with by abusing inventory+stat <a href=https://baldursgate.fandom.com/wiki/Exploits#Potion_Swap_Glitch>underflow</a></li>
<li>some <a href=https://baldursgate.fandom.com/wiki/Edwin_Odesseiron>NPCS</a> come with <a href=https://baldursgate.fandom.com/wiki/Edwin%27s_Amulet>gear</a> that blows <strong>marginally better stats</strong> out of the water</li>
</ul>
<p>So assuming you have a reason to be here despite this; let&rsquo;s dive in to some maths.</p>
<h2 id=multinomials-and-probabilities>Multinomials and probabilities</h2>
<blockquote>
<p>How likely are you to get a 90/95/100?</p>
</blockquote>
<p>The sum of rolling 18 six-sided dice follows an easier variant of the <a href=https://en.wikipedia.org/wiki/Multinomial_distribution>multinomial distribution</a> where we have equal event probabilities. We are going to follow the <em>simpler</em> multinomial expansion from <a href=https://mathworld.wolfram.com/Dice.html>mathworld/Dice</a> for <code>s=6</code> and <code>n=18</code> and find $P(x, 18, 6)$ which we will denote as $P(X = x)$; the chance of rolling a sum equal to $x$:</p>
<p>$$P(X = x) = \frac{1}{6^{18}} \sum_{k=0}^{\lfloor(x-18)/6\rfloor} (-1)^k \binom{18}{k} \binom{x-6k-1}{17}$$
$$ = \sum_{k=0}^{\lfloor(x-18)/6\rfloor} (-1)^k \frac{18}{k!(18-k)!} \frac{(x-6k-1)!}{(x-6k-18)!}$$</p>
<p>If we were to expand this expression, we would get 15 different expressions depending on how big of an $x$ you want to determine. So rather than trying to reduce this to a polynomial expression over $p$, we will <a href="https://www.wolframalpha.com/input?i2d=true&i=+Divide%5B1%2CPower%5B6%2C18%5D%5DSum%5BPower%5B%5C%2840%29-1%5C%2841%29%2Ck%5D+*binomial%5C%2840%2918%5C%2844%29+k%5C%2841%29*binomial%5C%2840%2991-6k-1%5C%2844%29+17%5C%2841%29%2C%7Bk%2C0%2Cfloor%5C%2840%29Divide%5B%5C%2840%2991-18%5C%2841%29%2C6%5D%5C%2841%29%7D%5D">paste values into wolfram alpha</a> and tabulate for $[18, \ldots, 108]$.</p>
<p>You can see the <a href=#appendix>appendix</a> for the numbers. Here we will just plot the values:</p>
<div id=probhist style=width:600px;height:450px></div>
<script>var ALL_X=[...Array(109).keys()].slice(18),MAIN_PROBS=[1/101559956668416,1/5642219814912,19/11284439629824,95/8463329722368,665/11284439629824,1463/5642219814912,33643/33853318889472,9605/2821109907456,119833/11284439629824,1552015/50779978334208,308465/3761479876608,97223/470184984576,2782169/5642219814912,1051229/940369969152,4550747/1880739938304,786505/156728328192,37624655/3761479876608,36131483/1880739938304,1206294965/33853318889472,20045551/313456656384,139474379/1253826625536,1059736685/5642219814912,128825225/417942208512,17143871/34828517376,8640663457/11284439629824,728073331/626913312768,2155134523/1253826625536,3942228889/1586874322944,4949217565/1410554953728,3417441745/705277476864,27703245169/4231664861184,3052981465/352638738432,126513483013/11284439629824,240741263447/16926659444736,199524184055/11284439629824,60788736553/2821109907456,2615090074301/101559956668416,56759069113/1880739938304,130521904423/3761479876608,110438453753/2821109907456,163027882055/3761479876608,88576807769/1880739938304,566880747559/11284439629824,24732579319/470184984576,101698030955/1880739938304,461867856157/8463329722368,101698030955/1880739938304,24732579319/470184984576,566880747559/11284439629824,88576807769/1880739938304,163027882055/3761479876608,110438453753/2821109907456,130521904423/3761479876608,56759069113/1880739938304,2615090074301/101559956668416,60788736553/2821109907456,199524184055/11284439629824,240741263447/16926659444736,126513483013/11284439629824,3052981465/352638738432,27703245169/4231664861184,3417441745/705277476864,4949217565/1410554953728,3942228889/1586874322944,2155134523/1253826625536,728073331/626913312768,8640663457/11284439629824,17143871/34828517376,128825225/417942208512,1059736685/5642219814912,139474379/1253826625536,20045551/313456656384,1206294965/33853318889472,36131483/1880739938304,37624655/3761479876608,786505/156728328192,4550747/1880739938304,1051229/940369969152,2782169/5642219814912,97223/470184984576,308465/3761479876608,1552015/50779978334208,119833/11284439629824,9605/2821109907456,33643/33853318889472,1463/5642219814912,665/11284439629824,95/8463329722368,19/11284439629824,1/5642219814912,1/101559956668416],MAIN_LEGEND=MAIN_PROBS.map(a=>"expected once in "+Intl.NumberFormat().format(Math.floor(1/a))+" rolls"),trace={x:ALL_X,y:MAIN_PROBS,name:'probability',text:MAIN_LEGEND,opacity:.8,type:"scatter"},data=[trace],layout={title:"Distribution for the sum of 18d6 dice rolls",xaxis:{title:"Roll"},yaxis:{title:"Probability"}},expectation_orig,variance_orig;Plotly.newPlot(document.getElementById('probhist'),data,layout),expectation_orig=MAIN_PROBS.map((a,b)=>(b+18)*a).reduce((a,b)=>a+b,0),variance_orig=MAIN_PROBS.map((a,b)=>Math.pow(b+18-expectation_orig,2)*a).reduce((a,b)=>a+b,0),console.log("Precise Expectation and variance for 18d6",expectation_orig,variance_orig)</script>
<p>and with the precise distribution we can also calculation expectation and variance:</p>
<ul>
<li>$E(X) = 63$</li>
<li>$Var(X) = 52.5 \thickapprox 7.24^2$</li>
</ul>
<p>This is how things <strong>should</strong> look on paper. From the chart you can extract:</p>
<ul>
<li><code>108</code> would be a once in <code>101 trillion</code> ($6^{18}$) event</li>
<li><code>107</code> would be a once in <code>5 trillion</code> event (<code>6^18/18</code>)</li>
<li><code>106</code> would be a once in <code>600 billion</code> event (5s in two places, or 4 in one place)</li>
<li><code>105</code> would be a once in <code>90 billion</code> event (3x5s, or 1x4 and 1x5, or 1x3)</li>
<li><code>104</code> would be a once in <code>16 billion</code> event (4x5s, 2x5s and 1x4, 2x4s, 1x5 and 1x3, 1x2)</li>
<li><code>103</code> would be a once in <code>4 billion</code> event (&mldr;)</li>
<li><code>102</code> would be a once in <code>1 billion</code> event</li>
<li><code>101</code> would be a once in <code>290 million</code> event</li>
<li><code>100</code> would be a once in <code>94 million</code> event</li>
<li><code>99</code> would be a once in <code>32 million</code> event</li>
<li>$\ldots$</li>
<li><code>95</code> would be a once in <code>900k</code> event (first number with prob &lt; 1 in a million)</li>
</ul>
<p><strong>But is this really right for BG?</strong> A <a href=https://old.reddit.com/r/baldursgate/comments/svnyy5/this_is_why_i_let_my_gf_roll_my_stats_lol/hxhde5k/>lot</a> of <a href=https://old.reddit.com/r/baldursgate/comments/tak2m7/say_hello_to_my_archer_roll/>people</a> have <a href=https://old.reddit.com/r/baldursgate/comments/rjnw22/less_than_a_minute_of_rolling_this_is_my_alltime/>all</a> rolled nineties in just a few hundred rolls, and many even getting <a href=https://old.reddit.com/r/baldursgate/comments/phr68a/my_new_highest_roll_10049_elf_mclovin_fightermage/>100</a> or <a href=https://old.reddit.com/r/baldursgate/comments/sq54wo/how_high_can_you_roll/>more</a>..was that extreme luck, or are higher numbers more likely than what this distribution says?</p>
<p>Well, let&rsquo;s start with the obvious:</p>
<blockquote>
<p><strong>The distribution is <a href=https://en.wikipedia.org/wiki/Censoring_(statistics)>censored</a>. We don&rsquo;t see the rolls below $75$.</strong></p>
</blockquote>
<div id=probhist2 style=width:600px;height:450px></div>
<script>var data=[{x:ALL_X,y:MAIN_PROBS,name:'probability',text:MAIN_LEGEND,opacity:.8,type:"scatter"}],layout={annotations:[{y:1/70,x:75,xref:'x',yref:'y',text:'cutoff',showarrow:!0,arrowhead:7,arrowcolor:"blue",ax:0,ay:-40}],xaxis:{title:"Roll"},yaxis:{title:"Probability"}};Plotly.newPlot(document.getElementById('probhist2'),data,layout)</script>
<p>What&rsquo;s <strong>left of this cutoff</strong> actually accounts for around <code>94%</code> of the distribution. <strong>If</strong> the game <strong>did not do this</strong>, you&rsquo;d be as likely getting <code>36</code> as a <code>90</code>. We are effectively throwing away &ldquo;19 bad rolls&rdquo; on every roll.</p>
<blockquote>
<p><code>AD&D 2e</code> had its <a href=https://advanced-dungeons-dragons-2nd-edition.fandom.com/wiki/Rolling_Ability_Scores>own ways to tilt the distribution</a> in a way that resulted in more powerful characters.</p>
</blockquote>
<p>How such a truncation or censoring is performed is at the mercy of the BG engine. We will <a href=https://en.wikipedia.org/wiki/Rectified_Gaussian_distribution>rectify</a> the distribution by <strong>scaling up</strong> the truncated version of our distribution, and show that this is correct later.</p>
<div id=probhist3 style=width:600px;height:450px></div>
<script>var prob_over_74=MAIN_PROBS.slice(75-18).reduce((a,b)=>a+b,0),SCALED_PROBS=MAIN_PROBS.slice(75-18).map(a=>a/prob_over_74),scaled_legend=SCALED_PROBS.map(a=>"expected once in "+Intl.NumberFormat().format(Math.floor(1/a))+" rolls"),trace={x:ALL_X.slice(75-18),y:SCALED_PROBS,name:'probability',text:scaled_legend,opacity:.8,type:"scatter"},data=[trace],layout={title:"Scaled Distribution",xaxis:{title:"Roll"},yaxis:{title:"Probability"}},expectation_trunc,variance_trunc;Plotly.newPlot(document.getElementById('probhist3'),data,layout),expectation_trunc=SCALED_PROBS.map((a,b)=>(b+75)*a).reduce((a,b)=>a+b,0),variance_trunc=SCALED_PROBS.map((a,b)=>Math.pow(b+75-expectation_trunc,2)*a).reduce((a,b)=>a+b,0),console.log("Precise Truncated Expectation and variance for 18d6",expectation_trunc,variance_trunc)</script>
<p>Here we have divided by the sum of the probabilities of the right hand side of the graph $P(X \ge 75)$ to get the new probability sum to <code>1</code>.</p>
<p>Using this scaled data, we can get precise, truncated distribution parameters:</p>
<ul>
<li>$E(X_T) = 77.525$</li>
<li>$Var(X_T) = 2.61^2$</li>
</ul>
<p>This <em>censored 18d6 multinomial distribution</em> is actually very close for certain cases, and we will <strong>demonstrate</strong> this.</p>
<p>But first, we are going to need to press the <code>reroll</code> button a lot&mldr;</p>
<h2 id=automating-rolling>Automating Rolling</h2>
<p>The simulation script / hacks we made is <a href=https://github.com/Thhethssmuz/bg2ee-stat-roll>found here</a>.</p>
<h3 id=tools>Tools</h3>
<p>We are playing on <strong>Linux</strong> with <code>X</code> and some obscure associated tooling:</p>
<ul>
<li><code>scrot</code> - X screenshot utility</li>
<li><code>xdotool</code> - X CLI automation tool</li>
<li><code>xwininfo</code> - X window information utility</li>
</ul>
<p>Basic strategy;</p>
<ul>
<li>find out where buttons are with <code>xwininfo</code></li>
<li>press the <code>reroll</code> button with <code>xdotool</code></li>
<li>take screenshot of the <code>total</code> number with <code>scrot</code></li>
<li>compare screenshot to previous rolls</li>
<li>press <code>store</code> when a new maximum is found</li>
</ul>
<p>The script also does some extra stuff to determine the strength roll, but that&rsquo;s not relevant here.</p>
<h3 id=initialization>Initialization</h3>
<p>To standardise what we are taking screenshots of, we need a consistent frame of reference.</p>
<p><code>xwininfo</code> will give us the <code>x,y</code> coordinates of the top left corner of the game window, and then hard-code the offsets from that because the game has a consistent layout. There is <a href=https://github.com/Thhethssmuz/bg2ee-stat-roll/blob/5a023de83c468224aa999b5b3c60f224aae76b97/roll.sh#L20-L84>some complexity</a> in doing this, but it has so far worked well.</p>
<blockquote>
<p><strong>Caveat</strong>: You need to have <strong>scaled the window</strong> to size >= 1024x768 to avoid UI downscaling.</p>
</blockquote>
<p>The standardised approach also helps with dealing with rolls, and it let us populate a roll-table quickly.</p>
<h3 id=roll-tables>Roll Tables</h3>
<p>Taking screenshots is pretty easy. Use <code>scrot</code> at an <code>x,y</code> coordinate followed by lenghts; <code>,width,height</code> as remaining arguments defining the square to screenshot:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>scrot -a <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>STR_TOP_LEFT_X</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>,</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>STR_TOP_LEFT_Y</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>,49,17&#34;</span> -
</code></pre></div><p>the output of this can be piped to a <code>.png</code> and passed to <code>compare</code> (part of <code>imagemagick</code> package), to compare values based on thresholds. However, this idea is actually overkill..</p>
<p>The menu background is <strong>static</strong> and the resulting screenshots are actually <strong>completely deterministic per value</strong>, so we can instead just compare them by their hashes in one big <code>switch</code> (i.e. after piping to <code>md5</code>) and use that as our <a href=https://github.com/Thhethssmuz/bg2ee-stat-roll/blob/5a023de83c468224aa999b5b3c60f224aae76b97/roll.sh#L130-L159>roll table</a>, Excerpt:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>    d74939b47327e4f2c1b781d64e2ab28d*<span style=color:#ff79c6>)</span> <span style=color:#8be9fd;font-style:italic>CURRENT_ROLL</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>90</span> ;;
    ca49ce8b4c9c0f814dab24668f7313fe*<span style=color:#ff79c6>)</span> <span style=color:#8be9fd;font-style:italic>CURRENT_ROLL</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>91</span> ;;
    3e6f8127ac0634bb1fc20acf40c95c48*<span style=color:#ff79c6>)</span> <span style=color:#8be9fd;font-style:italic>CURRENT_ROLL</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>92</span> ;;
    7f849edd84a4be895f5c58b4f5b20d4e*<span style=color:#ff79c6>)</span> <span style=color:#8be9fd;font-style:italic>CURRENT_ROLL</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>93</span> ;;
    b8f90179e2a0e975fc2647bc7439d9c6*<span style=color:#ff79c6>)</span> <span style=color:#8be9fd;font-style:italic>CURRENT_ROLL</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>94</span> ;;
    b1d3b73de16d750b265f5c63000ccd54*<span style=color:#ff79c6>)</span> <span style=color:#8be9fd;font-style:italic>CURRENT_ROLL</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>95</span> ;;
    87413f7310bd06b0b66fb4d2e61c5c7a*<span style=color:#ff79c6>)</span> <span style=color:#8be9fd;font-style:italic>CURRENT_ROLL</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>96</span> ;;
    b489ad2a17456f8eebe843e4b7e3e685*<span style=color:#ff79c6>)</span> <span style=color:#8be9fd;font-style:italic>CURRENT_ROLL</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>97</span> ;;
    25112e67464791f24f9e2e99d38ef9d7*<span style=color:#ff79c6>)</span> <span style=color:#8be9fd;font-style:italic>CURRENT_ROLL</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>98</span> ;;
    9c3720b9d3ab1d7f0d11dfb9771a1aef*<span style=color:#ff79c6>)</span> <span style=color:#8be9fd;font-style:italic>CURRENT_ROLL</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>99</span> ;;
    3ef9bf6cd4d9946d89765870e5b21566*<span style=color:#ff79c6>)</span> <span style=color:#8be9fd;font-style:italic>CURRENT_ROLL</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>100</span> ;;
</code></pre></div><h2 id=clicking>Clicking</h2>
<p>Automating a click is simply:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>xdotool mousemove <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$REROLL_BTN_X</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$REROLL_BTN_Y</span><span style=color:#f1fa8c>&#34;</span> click --delay<span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span> <span style=color:#bd93f9>1</span>
</code></pre></div><p>where the <code>--delay=0</code> overrides a builtin delay between clicks.</p>
<p>The only complication here is that BG performs <strong>internal buffering</strong> of clicks, so this allows us to blast through numbers faster than the screen can display them. This means we have to compensate with a <code>sleep 0.001</code> after clicking to ensure we can grab the <code>scrot</code> of the roll before another click is registered.</p>
<h2 id=showcase>Showcase</h2>
<p>Running the script (with a terminal showing the script output overlayed) looks like this:</p>
<div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden>
<iframe src=https://www.youtube.com/embed/849xInj3GmI style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe>
</div>
<p>On my machine, we get just over <strong>15 rolls per second</strong>.</p>
<h2 id=sampling>Sampling</h2>
<p>We rolled a human <code>fighter</code>, <code>paladin</code>, and a <code>ranger</code> overnight with roughly half a million rolls each (see <a href=#appendix>appendix</a>), and we got these values:</p>
<div id=rollhist style=width:600px;height:450px></div>
<script>var x=[...Array(109).keys()].slice(75),samples={fighter:[137379,109198,85620,65004,48256,35041,24987,17545,11981,7883,5007,3139,1946,1138,670,368,199,103,49,26,12,6,2,1],paladin:[50888,54911,57338,57442,55589,52357,47503,41339,34458,28599,21997,16722,12322,8697,5997,3774,2371,1489,822,465,251,129,56,24,12,4,1,1],ranger:[32296,37790,43118,46609,48108,47589,45774,41963,36876,30973,25272,19904,14730,10430,7285,4667,2991,1696,986,529,254,121,56,26,10,1]},trace_observations=function(a){var b=samples[a],c;let d=b.reduce((a,b)=>a+b,0);return c=b.map(a=>a/d),{x,y:c,name:'observed '+a,text:c.map(a=>"occurred once in "+Math.floor(1/a)+" rolls"),opacity:.8,type:"scatter"}},trace_obs_fighter=trace_observations('fighter'),trace_obs_paladin=trace_observations('paladin'),trace_obs_ranger=trace_observations('ranger'),data=[trace_obs_fighter,trace_obs_paladin,trace_obs_ranger],layout={title:"Roll Results",xaxis:{title:"Roll"},yaxis:{title:"Observed probability"}};Plotly.newPlot(document.getElementById('rollhist'),data,layout)</script>
<p>Let&rsquo;s start with the <strong>fighter</strong>. If we compare the fighter graph with our precise, censored multinomial distribution, they are <strong>very close</strong>:</p>
<div id=probhist4 style=width:600px;height:450px></div>
<script>var prob_over_74=MAIN_PROBS.slice(75-18).reduce((a,b)=>a+b,0),SCALED_PROBS=MAIN_PROBS.slice(75-18).map(a=>a/prob_over_74),scaled_legend=SCALED_PROBS.map(a=>"expected once in "+Intl.NumberFormat().format(Math.floor(1/a))+" rolls"),data,layout;let trace_single_trunc={x:ALL_X.slice(75-18),y:SCALED_PROBS,name:'fighter multinomial 18d6',text:scaled_legend,opacity:.8,type:"scatter"};data=[trace_single_trunc,trace_obs_fighter],layout={title:"Distribution vs. Observed Fighter",xaxis:{title:"Roll"},yaxis:{title:"Probability"}},Plotly.newPlot(document.getElementById('probhist4'),data,layout)</script>
<p>So for <strong>fighters</strong>, we can be pretty happy with the calculations we have done, and can use the precise probabilities as a guide.</p>
<blockquote>
<p>How long would it take you to achieve >95 for a fighter using the script?</p>
</blockquote>
<ul>
<li><code>108</code> is a once in <code>5 trillion</code> event (10,000 years)</li>
<li><code>107</code> is a once in <code>300 billion</code> event (600 years)</li>
<li><code>106</code> is a once in <code>33 billion</code> event (69 years)</li>
<li><code>105</code> is a once in <code>5 billion</code> event (10 years)</li>
<li><code>104</code> is a once in <code>900 million</code> event (2 years)</li>
<li><code>103</code> is a once in <code>200 million</code> event (5 months)</li>
<li><code>102</code> is a once in <code>50 million</code> event (5 weeks)</li>
<li><code>101</code> is a once in <code>16 million</code> event (2 weeks)</li>
<li><code>100</code> is a once in <code>5 million</code> event (4 days)</li>
<li><code>99</code> is a once in <code>2 million</code> event (1.5 day)</li>
<li><code>98</code> is a once in <code>700k</code> event (12h)</li>
<li><code>97</code> is a once in <code>270k</code> event (5h)</li>
<li><code>96</code> is a once in <code>110k</code> event (2h)</li>
<li><code>95</code> is a once in <code>50k</code> event (55m)</li>
</ul>
<p>So if we only look at human fighters or mages, we can stop here:</p>
<blockquote>
<p>We are actually quite a lot more likely to get a good roll early than what just the pure dice math would indicate thanks to censoring (50k rolls => likely <code>95</code> rather than estimated <code>90</code> without censoring).</p>
</blockquote>
<p>However, what&rsquo;s up with the paladins and rangers? Time for a more painful math detour.</p>
<p><img src=https://clux.dev/imgs/bg/amicat1-math.gif alt="sweat mile cat math"></p>
<h3 id=classrace-variance>Class/Race Variance</h3>
<p>The reason for the discrepancy is simple: <a href=https://rpg.stackexchange.com/questions/165377/how-do-baldurs-gate-and-baldurs-gate-2s-rolling-for-stats-actually-get-gene>stat floors based on races/class</a>.</p>
<p>These stat floors are insignificant in some cases, but highly significant in others. Some highly floored classes actually push the uncensored mean above the <code>75</code> cutoff even though it&rsquo;s a whole 12 points above the mean of the original underlying distribution.</p>
<p>The floors for a some of the classes:</p>
<ul>
<li><strong>fighter</strong> mins: <code>STR=9</code>, rest <code>3</code></li>
<li><strong>mage</strong> mins: <code>INT=9</code>, rest <code>3</code></li>
<li><strong>paladin</strong> mins: <code>CHA=17</code>, <code>WIS=13</code>, <code>STR=12</code>, <code>CON=9</code>, rest <code>3</code></li>
<li><strong>ranger</strong> mins: <code>CON=14</code>, <code>WIS=14</code>, <code>STR=13</code>, <code>DEX=13</code>, rest <code>3</code></li>
<li><strong><a href=https://old.reddit.com/r/baldursgate/comments/reevp6/everyone_enjoys_a_good_high_ability_score_role_so/>other classes</a></strong> mins: generally light floors</li>
</ul>
<p><em>In other words</em>: paladins and rangers have significantly higher rolls on average.</p>
<blockquote>
<p>Sidenote: in <code>2e</code> you actually rolled stats first, and <strong>only if</strong> you met the <strong>requirements</strong> could you become a Paladin / Ranger. It&rsquo;s an interesting choice. Would not call this fun.</p>
</blockquote>
<p>Anyway. Is it possible to incorporate these floors into our modelling?</p>
<h2 id=floored-ability-distributions>Floored Ability Distributions</h2>
<p>If floors are involved at earlier stages, we have to take a step back and look at the distributions that make up the sum. We <strong>can</strong> compute distributions for <strong>individual ability scores</strong> (even if floored) if we use the distribution for $P(x, 3, 6)$ from <a href=https://mathworld.wolfram.com/Dice.html>mathworld/Dice</a> where <code>s=6</code> and <code>n=3</code> and censor it at a cutoff point similar to how we censor the total distribution.</p>
<p>Computing the value without a floor follows the same setup as when we did 18 dice; use <a href="https://www.wolframalpha.com/input?i2d=true&i=+Divide%5B1%2CPower%5B6%2C3%5D%5DSum%5BPower%5B%5C%2840%29-1%5C%2841%29%2Ck%5D+*binomial%5C%2840%293%5C%2844%29+k%5C%2841%29*binomial%5C%2840%2910-6k-1%5C%2844%29+2%5C%2841%29%2C%7Bk%2C0%2Cfloor%5C%2840%29Divide%5B%5C%2840%2910-3%5C%2841%29%2C6%5D%5C%2841%29%7D%5D">wolfram alpha</a> and tabulate for $[3, \ldots, 18]$:</p>
<div id=probhist3roll style=width:600px;height:450px></div>
<script>var THREEROLL_X=[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],THREEROLL_PROBS=[1/216,1/72,1/36,5/108,5/72,7/72,25/216,1/8,1/8,25/216,7/72,5/72,5/108,1/36,1/72,1/216],expectation_unt,variance_unt,trace,data,layout;console.log("probability sum for 3d6 =",THREEROLL_PROBS.reduce((a,b)=>a+b,0)),expectation_unt=THREEROLL_PROBS.map((a,b)=>(b+3)*a).reduce((a,b)=>a+b,0),variance_unt=THREEROLL_PROBS.map((a,b)=>Math.pow(b+3-expectation_unt,2)*a).reduce((a,b)=>a+b,0),console.log("Expectation, variance for untruncated 3d6",expectation_unt,variance_unt),trace={x:THREEROLL_X,y:THREEROLL_PROBS,name:'probability',text:THREEROLL_PROBS.map(a=>"expected once in "+Intl.NumberFormat().format(Math.floor(1/a))+" rolls"),opacity:.8,type:"scatter"},data=[trace],layout={title:"Distribution for the sum of 3d6 dice rolls",xaxis:{title:"Roll"},yaxis:{title:"Probability"}},Plotly.newPlot(document.getElementById('probhist3roll'),data,layout)</script>
<p>then we truncate + scale this at the observed floor points <code>9</code>, <code>12</code>, <code>13</code>, <code>14</code>, and <code>17</code>:</p>
<div id=probhist3rolltruncs style=width:600px;height:450px></div>
<script>var TRUNCATED_DISTS={},truncated_trace,data,layout;TRUNCATED_DISTS[0]=THREEROLL_PROBS.slice(),TRUNCATED_DISTS[3]=THREEROLL_PROBS.slice(),truncated_trace=function(a){var d=THREEROLL_PROBS.slice(a-3).reduce((a,b)=>a+b,0),b=THREEROLL_PROBS.slice(a-3).map(a=>a/d),c=b.map((b,c)=>(c+a)*b).reduce((a,b)=>a+b,0),e=b.map((b,d)=>Math.pow(d+a-c,2)*b).reduce((a,b)=>a+b,0),f;return console.log("Expectation, variance for truncated 3d6 at",a,c,e),TRUNCATED_DISTS[a]=b,f={x:THREEROLL_X.slice(a-3),y:b,name:'floor '+a,text:b.map(a=>"expected once in "+Intl.NumberFormat('en-IN',{maximumSignificantDigits:2}).format(1/a)+" rolls"),opacity:.8,type:"scatter"},f};let trace_9=truncated_trace(9),trace_12=truncated_trace(12),trace_13=truncated_trace(13),trace_14=truncated_trace(14),trace_17=truncated_trace(17);data=[trace_9,trace_12,trace_13,trace_14,trace_17],layout={title:"Rectified Distribution for the sum of 3d6 dice rolls",xaxis:{title:"Roll"},yaxis:{title:"Probability"}},Plotly.newPlot(document.getElementById('probhist3rolltruncs'),data,layout)</script>
<p>To avoid having to write out conditionals $P(X = x| X\ge k)$ everywhere we will denote $X^{\lfloor k \rfloor}$ as one of these graphed multinomial distributions for the sum of <code>3d6</code> floored at $k$:</p>
<p>$$X^{\lfloor k \rfloor} \sim \mathcal{M}^{\lfloor k \rfloor}(3d6)$$</p>
<p>Note also that an unfloored ability score $X$ is equal to $X^{\lfloor3\rfloor}$.</p>
<p>We can then compute precise conditional expectations by floor:</p>
<ul>
<li>$\mathbb{E}(X^{\lfloor3\rfloor}) = \mathbb{E}(X) = 3\sum_{k=1}^{6}\frac{k}{6} = 3*3.5 = 10.5$</li>
<li>$\mathbb{E}(X^{\lfloor9\rfloor}) = 11.8125$</li>
<li>$\mathbb{E}(X^{\lfloor12\rfloor}) = 13.5555$</li>
<li>$\mathbb{E}(X^{\lfloor13\rfloor}) = 14.2500$</li>
<li>$\mathbb{E}(X^{\lfloor14\rfloor}) = 15.0000$</li>
<li>$\mathbb{E}(X^{\lfloor17\rfloor}) = 17.2500$</li>
</ul>
<p>Similarly, we can compute precise variances:</p>
<ul>
<li>$Var(X^{\lfloor3\rfloor}) = Var(X) = 3\sum_{k=1}^6\frac{(x_i - 3.5)^2}{6} = 3*2.92 = 8.75$</li>
<li>$Var(X^{\lfloor9\rfloor}) = 4.5773$</li>
<li>$Var(X^{\lfloor12\rfloor}) = 2.2469$</li>
<li>$Var(X^{\lfloor13\rfloor}) = 1.6875$</li>
<li>$Var(X^{\lfloor14\rfloor}) = 1.2000$</li>
<li>$Var(X^{\lfloor17\rfloor}) = 0.1875$</li>
</ul>
<h3 id=sum-of-floored-ability-distributions>Sum of Floored Ability Distributions</h3>
<p>Define $Z_{paladin}$, $Z_{ranger}$ and $Z_{fighter}$ as:</p>
<p>$$Z_{paladin} = X_1^{\lfloor17\rfloor} + X_2^{\lfloor13\rfloor} + X_3^{\lfloor12\rfloor} + X_4^{\lfloor9\rfloor} + X_5^{\lfloor3\rfloor} + X_6^{\lfloor3\rfloor}$$
$$Z_{ranger} = X_1^{\lfloor14\rfloor} + X_2^{\lfloor14\rfloor} + X_3^{\lfloor13\rfloor} + X_4^{\lfloor13\rfloor} + X_5^{\lfloor3\rfloor} + X_6^{\lfloor3\rfloor}$$
$$Z_{fighter} = X_1^{\lfloor9\rfloor} + X_2^{\lfloor3\rfloor} + X_3^{\lfloor3\rfloor} + X_4^{\lfloor3\rfloor} + X_5^{\lfloor3\rfloor} + X_6^{\lfloor3\rfloor}$$</p>
<p>for floored 3d6 based random variables $X_i^{\lfloor N \rfloor} \sim \mathcal{M}^{\lfloor N \rfloor}(3d6)$.</p>
<p>Using the computed expectations above to sum across the 6 main stats:</p>
<ul>
<li>$\mathbb{E}(Fighter) = \mathbb{E}(X^{\lfloor9\rfloor}) + 5\mathbb{E}(X) = 64.31$</li>
<li>$\mathbb{E}(Ranger) = 2\mathbb{E}(X^{\lfloor14\rfloor}) + 2\mathbb{E}(X^{\lfloor13\rfloor}) + 2\mathbb{E}(X) = 79.5$</li>
<li>$\mathbb{E}(Paladin) = \mathbb{E}(X^{\lfloor17\rfloor}) + \mathbb{E}(X^{\lfloor13\rfloor}) + \mathbb{E}(X^{\lfloor12\rfloor}) + \mathbb{E}(X^{\lfloor9\rfloor})+ 2\mathbb{E}(X) = 77.86$</li>
</ul>
<p>and similarly for variance:</p>
<ul>
<li>$Var(Fighter) = Var(X^{\lfloor9\rfloor}) + 5Var(X) \thickapprox 6.95^2$</li>
<li>$Var(Ranger) = 2Var(X^{\lfloor14\rfloor}) + 2Var(X^{\lfloor13\rfloor}) + 2Var(X) \thickapprox 4.82^2$</li>
<li>$Var(Paladin) = Var(X^{\lfloor17\rfloor}) + Var(X^{\lfloor13\rfloor}) + Var(X^{\lfloor12\rfloor}) + Var(X^{\lfloor3\rfloor})+ 2Var(X) \thickapprox 5.12^2$</li>
</ul>
<p>noting that variables are independent under the observed two stage censoring.</p>
<blockquote>
<p>Why can we rely on two stage censoring and their independence? If any of these internal mechanisms used some kind of <code>if</code> condition or <code>min</code> function, it would be immediately obvious from the distribution. The paladin distribution of charisma is clearly a <code>~1/4</code> for an <code>18</code>, and <code>~3/4</code> for a <code>17</code>; it would have been much rarer to see an 18 otherwise.</p>
</blockquote>
<p>Thus, the distributions of our classes are based on multinomal-based distributions with the following first moments:</p>
<ul>
<li>$Uncensored\ Fighter \sim \mathcal{M}(\mu = 64.31, \sigma^2 = 6.95^2)$</li>
<li>$Uncensored\ Ranger \sim \mathcal{M}(\mu = 79.5, \sigma^2 = 4.82^2)$</li>
<li>$Uncensored\ Paladin \sim \mathcal{M}(\mu = 77.86, \sigma^2 = 5.12^2)$</li>
</ul>
<p>This is nice as a quick overview of what&rsquo;s best in the higher ranges, but it&rsquo;s not very precise. Without the <strong><a href=https://en.wikipedia.org/wiki/Probability_mass_function>PMF</a></strong> for the <strong>sum of our ability scores</strong>, it&rsquo;s hard to give good values for what the truncated version will look like (we are censoring in two stages). In particular, these heavily floored random variables end up giving us quite asymmetrical distributions in the tails.</p>
<h3 id=class-distributions>Class Distributions</h3>
<p>Thankfully, it is possible to inductively compute the pmf of $Z_{class}$ via <a href=https://en.wikipedia.org/wiki/Convolution#Discrete_convolution>convolution</a>.</p>
<p>Some internet digging notwithstanding; most answers found online for this required <strong>either</strong> <a href=https://stats.stackexchange.com/questions/3614/how-to-easily-determine-the-results-distribution-for-multiple-dice/3684#3684>mathematica functions</a> (that we do not have here in our inlined source), <strong>or</strong> a slightly more laborious manual convolution. We will follow the <a href=https://stats.libretexts.org/Bookshelves/Probability_Theory/Book%3A_Introductory_Probability_(Grinstead_and_Snell)/07%3A_Sums_of_Random_Variables/7.01%3A_Sums_of_Discrete_Random_Variables>inductive convolution approach</a> which we can solve with recursion. Paladin case:</p>
<p>Let $X_{12} = X_1^{\lfloor17\rfloor} + X_2^{\lfloor13\rfloor}$. We can generate values for the pmf $p_{X_{12}}$ for $X_{12}$ via the pmfs $p_{X_i}$ for $X_1^{\lfloor17\rfloor}$ and $X_2^{\lfloor13\rfloor}$ via the convolution formula:</p>
<p>$$P(X_{12} = n) = (p_{X_1} * p_{X_2})(n) = \sum_{m=-\infty}^{\infty}P(X_1=m)P(X_2 = n-m)$$</p>
<p>This step is particularly easy for the paladin, because $X_1^{\lfloor17\rfloor}$ only takes two values (i.e. $m=17$ ahd $m=18$ are the only non-zero parts in the sum).</p>
<p>The rest is less easy to do by hand, as the sums get increasingly large while we iterate towards $Z=P_{123456}$ by repeatedly applying convolution to the remaining $X_i$:</p>
<p>$$P(X_{123} = n) = (p_{X_{12}} * p_{X_3})(n) \sum_{m=-\infty}^{\infty}P(X_{12}=m)P(X_3 = n-m)$$</p>
<p>$$P(X_{1234} = n) = (p_{X_{123}} * p_{X_4})(n) \sum_{m=-\infty}^{\infty}P(X_{123}=m)P(X_4 = n-m)$$</p>
<p>$$P(X_{12345} = n) = (p_{X_{1234}} * p_{X_5})(n) \sum_{m=-\infty}^{\infty}P(X_{1234}=m)P(X_5 = n-m)$$</p>
<p>$$P(X_{123456} = n) = (p_{X_{12345}} * p_{X_5})(n) \sum_{m=-\infty}^{\infty}P(X_{12345}=m)P(X_6 = n-m)$$</p>
<p>The hard work is correctly matching indexes in our probability arrays that serve as our mass functions to the sum, and defaulting to zero when accessing out of bounds:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#6272a4>// given pXi = [0.75, 0.25], pXj = [0.375, 0.2678, 0.1786, 0.1071, 0.05357, 0.01786]
</span><span style=color:#6272a4>// (approximations of the first two truncated paladin probability arrays for CHA + WIS)
</span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>var</span> convolve <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>function</span> (pXi, pXj) {
  <span style=color:#6272a4>// pre-allocate a zero-indexed array where our probabilities will go
</span><span style=color:#6272a4></span>  <span style=color:#8be9fd;font-style:italic>var</span> pXij <span style=color:#ff79c6>=</span> [...<span style=color:#8be9fd;font-style:italic>Array</span>(pXi.length <span style=color:#ff79c6>+</span> pXj.length <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>1</span>).keys()];
  <span style=color:#6272a4>// loop to generate P(Xij = n) for all n
</span><span style=color:#6272a4></span>  <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd;font-style:italic>let</span> n <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; n <span style=color:#ff79c6>&lt;</span> pXi.length <span style=color:#ff79c6>+</span> pXj.length <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>1</span>; n <span style=color:#ff79c6>+=</span> <span style=color:#bd93f9>1</span>) {
    pXij[n] <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; <span style=color:#6272a4>// init to zero
</span><span style=color:#6272a4></span>    <span style=color:#6272a4>// loop to do sum over m, first variable determines length of this sum
</span><span style=color:#6272a4></span>    <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd;font-style:italic>let</span> m <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; m <span style=color:#ff79c6>&lt;</span> pXi.length; m <span style=color:#ff79c6>+=</span> <span style=color:#bd93f9>1</span>) {
      <span style=color:#6272a4>// we do defaulting outside range with `|| 0`
</span><span style=color:#6272a4></span>      pXij[n] <span style=color:#ff79c6>+=</span> (pXi[m] <span style=color:#ff79c6>||</span> <span style=color:#bd93f9>0</span>) <span style=color:#ff79c6>*</span> (pXj[n<span style=color:#ff79c6>-</span>m] <span style=color:#ff79c6>||</span> <span style=color:#bd93f9>0</span>);
    }
  }
  <span style=color:#ff79c6>return</span> pXij;
};
<span style=color:#6272a4>// returns [0.28125, 0.29464, 0.2009, 0.125, 0.06696, 0.02678, 0.004464]
</span></code></pre></div><p>Using this, we can compute the PMF for $Z_{class} = X_{123456}$:</p>
<p>$$P(Z_{class} = z) = (((((p_{X_1} * p_{X_2}) * p_{X_3}) * p_{X_4}) * p_{X_5}) * p_{X_6}) (z)$$</p>
<p>and we graph them for various classes:</p>
<div id=probhist3convolved style=width:600px;height:450px></div>
<script>var convolve=function(a,b){var c=[...Array(a.length+b.length-1).keys()];for(let d=0;d<a.length+b.length-1;d+=1){c[d]=0;for(let e=0;e<a.length;e+=1)c[d]+=(a[e]||0)*(b[d-e]||0)}return c},gen_convolved_trace_for_class_dist,trace_paladin,trace_ranger,trace_fighter,data,layout;CONVOLVED_DISTS={},gen_convolved_trace_for_class_dist=function(a,c){var d=TRUNCATED_DISTS[a[0]],e=TRUNCATED_DISTS[a[1]],f=TRUNCATED_DISTS[a[2]],g=TRUNCATED_DISTS[a[3]],h=TRUNCATED_DISTS[a[4]],n=TRUNCATED_DISTS[a[5]],i=a.reduce((a,b)=>a+b,0);let j=convolve(d,e),k=convolve(j,f),l=convolve(k,g),m=convolve(l,h),b=convolve(m,n);return CONVOLVED_DISTS[c]=b,{x:b.slice().map((b,a)=>a+i),y:b,name:c,text:b.map(a=>"expected once in "+Intl.NumberFormat().format(Math.floor(1/a))+" rolls"),opacity:.8,type:"scatter"}},trace_paladin=gen_convolved_trace_for_class_dist([17,13,12,9,3,3],'paladin'),trace_ranger=gen_convolved_trace_for_class_dist([14,14,13,13,3,3],'ranger'),trace_fighter=gen_convolved_trace_for_class_dist([9,3,3,3,3,3],'fighter'),trace_fighter.visible='legendonly',data=[trace_paladin,trace_ranger,trace_fighter],layout={title:"Convolved Ability Distributions for Classes",xaxis:{title:"Roll"},yaxis:{title:"Probability"}},Plotly.newPlot(document.getElementById('probhist3convolved'),data,layout)</script>
<blockquote>
<p>Notice the heavily tilted ranger/paladin distributions whose lean is distinctively more to the right.</p>
</blockquote>
<p>The last thing that&rsquo;s left now is to rectify $Z_c$ at <code>75</code> to get our <strong>true, final distributions</strong>:</p>
<div id=probhist3convolvedtrunc style=width:600px;height:450px></div>
<script>var truncated_klass=function(b){let c=CONVOLVED_DISTS[b],d=c.slice(-(108-75+1)).reduce((a,b)=>a+b,0),a=c.slice(-(108-75+1)).map(a=>a/d);return console.log("Sum of convolved truncated",b,a.reduce((a,b)=>a+b,0)),{x:a.map((b,a)=>a+75),y:a,name:'true '+b,text:a.map(a=>"expected once in "+Intl.NumberFormat().format(Math.floor(1/a))+" rolls"),opacity:.8,type:"scatter"}},data,layout;let trace_trunconv_paladin=truncated_klass('paladin'),trace_trunconv_fighter=truncated_klass('fighter'),trace_trunconv_ranger=truncated_klass('ranger');trace_trunconv_fighter.visible='legendonly',data=[trace_trunconv_paladin,trace_trunconv_fighter,trace_trunconv_ranger],layout={title:"True Roll Distributions for Classes",xaxis:{title:"Roll"},yaxis:{title:"Probability"}},Plotly.newPlot(document.getElementById('probhist3convolvedtrunc'),data,layout)</script>
<p>These match the sampled data almost perfectly as can be seen in more detailed comparisons in the <a href=#appendix>appendix</a>.</p>
<p>As can be seen; <code>ranger</code> is faster at getting high numbers, particularly in the 90 -> 97 range, but if you want rolls >= 100, <strong><code>paladin</code> rolls the highest</strong> at the fastest rate.</p>
<p>We end with the expected time to roll above a certain threshold where we use the most efficient class based on the number:</p>
<ul>
<li><code>108</code> paladin rolls once in <code>100 billion</code> ⇒ 210y</li>
<li><code>107</code> paladin rolls once in <code>5 billion</code> ⇒ 10y</li>
<li><code>106</code> paladin rolls once in <code>600 million</code> ⇒ 1y</li>
<li><code>105</code> paladin rolls once in <code>100 million</code> ⇒ 11w</li>
<li><code>104</code> paladin rolls once in <code>19 million</code> ⇒ 2w</li>
<li><code>103</code> paladin rolls once in <code>5 million</code> ⇒ 4d</li>
<li><code>102</code> paladin rolls once in <code>1.4 million</code> ⇒ 1d</li>
<li><code>101</code> paladin rolls once in <code>400k</code> ⇒ 7h</li>
<li><code>100</code> paladin/ranger rolls once in <code>150k</code> ⇒ 3h</li>
<li><code>99</code> ranger rolls once in <code>57k</code> ⇒ 1h</li>
<li><code>98</code> ranger rolls once in <code>23k</code> ⇒ 25m</li>
<li><code>97</code> ranger rolls once in <code>10k</code> ⇒ 11m</li>
<li><code>96</code> ranger rolls once in <code>5k</code> ⇒ 5m</li>
<li><code>95</code> ranger rolls once in <code>2k</code> ⇒ 2m</li>
</ul>
<p>Hope you have enjoyed this random brain dump on probability. Don&rsquo;t think I have ever been nerd sniped this hard before.. I just wanted to play a game and take a break.</p>
<p><small>/me closes 20 tabs</small></p>
<h2 id=appendix>Appendix</h2>
<details><summary style=cursor:pointer><b>1. Raw simulation data</b></summary>
<p>
<p>10 hour paladin roll (<code>555558</code> rolls in <code>601m</code>)</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>75</span>: <span style=color:#bd93f9>50888</span>
<span style=color:#ff79c6>76</span>: <span style=color:#bd93f9>54911</span>
<span style=color:#ff79c6>77</span>: <span style=color:#bd93f9>57338</span>
<span style=color:#ff79c6>78</span>: <span style=color:#bd93f9>57442</span>
<span style=color:#ff79c6>79</span>: <span style=color:#bd93f9>55589</span>
<span style=color:#ff79c6>80</span>: <span style=color:#bd93f9>52357</span>
<span style=color:#ff79c6>81</span>: <span style=color:#bd93f9>47503</span>
<span style=color:#ff79c6>82</span>: <span style=color:#bd93f9>41339</span>
<span style=color:#ff79c6>83</span>: <span style=color:#bd93f9>34458</span>
<span style=color:#ff79c6>84</span>: <span style=color:#bd93f9>28599</span>
<span style=color:#ff79c6>85</span>: <span style=color:#bd93f9>21997</span>
<span style=color:#ff79c6>86</span>: <span style=color:#bd93f9>16722</span>
<span style=color:#ff79c6>87</span>: <span style=color:#bd93f9>12322</span>
<span style=color:#ff79c6>88</span>: <span style=color:#bd93f9>8697</span>
<span style=color:#ff79c6>89</span>: <span style=color:#bd93f9>5997</span>
<span style=color:#ff79c6>90</span>: <span style=color:#bd93f9>3774</span>
<span style=color:#ff79c6>91</span>: <span style=color:#bd93f9>2371</span>
<span style=color:#ff79c6>92</span>: <span style=color:#bd93f9>1489</span>
<span style=color:#ff79c6>93</span>: <span style=color:#bd93f9>822</span>
<span style=color:#ff79c6>94</span>: <span style=color:#bd93f9>465</span>
<span style=color:#ff79c6>95</span>: <span style=color:#bd93f9>251</span>
<span style=color:#ff79c6>96</span>: <span style=color:#bd93f9>129</span>
<span style=color:#ff79c6>97</span>: <span style=color:#bd93f9>56</span>
<span style=color:#ff79c6>98</span>: <span style=color:#bd93f9>24</span>
<span style=color:#ff79c6>99</span>: <span style=color:#bd93f9>12</span>
<span style=color:#ff79c6>100</span>: <span style=color:#bd93f9>4</span>
<span style=color:#ff79c6>101</span>: <span style=color:#bd93f9>1</span>
<span style=color:#ff79c6>102</span>: <span style=color:#bd93f9>1</span>
</code></pre></div><p>10 hour fighter roll (<code>555560</code> rolls in <code>608m</code>)</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>75</span>: <span style=color:#bd93f9>137379</span>
<span style=color:#ff79c6>76</span>: <span style=color:#bd93f9>109198</span>
<span style=color:#ff79c6>77</span>: <span style=color:#bd93f9>85620</span>
<span style=color:#ff79c6>78</span>: <span style=color:#bd93f9>65004</span>
<span style=color:#ff79c6>79</span>: <span style=color:#bd93f9>48256</span>
<span style=color:#ff79c6>80</span>: <span style=color:#bd93f9>35041</span>
<span style=color:#ff79c6>81</span>: <span style=color:#bd93f9>24987</span>
<span style=color:#ff79c6>82</span>: <span style=color:#bd93f9>17545</span>
<span style=color:#ff79c6>83</span>: <span style=color:#bd93f9>11981</span>
<span style=color:#ff79c6>84</span>: <span style=color:#bd93f9>7883</span>
<span style=color:#ff79c6>85</span>: <span style=color:#bd93f9>5007</span>
<span style=color:#ff79c6>86</span>: <span style=color:#bd93f9>3139</span>
<span style=color:#ff79c6>87</span>: <span style=color:#bd93f9>1946</span>
<span style=color:#ff79c6>88</span>: <span style=color:#bd93f9>1138</span>
<span style=color:#ff79c6>89</span>: <span style=color:#bd93f9>670</span>
<span style=color:#ff79c6>90</span>: <span style=color:#bd93f9>368</span>
<span style=color:#ff79c6>91</span>: <span style=color:#bd93f9>199</span>
<span style=color:#ff79c6>92</span>: <span style=color:#bd93f9>103</span>
<span style=color:#ff79c6>93</span>: <span style=color:#bd93f9>49</span>
<span style=color:#ff79c6>94</span>: <span style=color:#bd93f9>26</span>
<span style=color:#ff79c6>95</span>: <span style=color:#bd93f9>12</span>
<span style=color:#ff79c6>96</span>: <span style=color:#bd93f9>6</span>
<span style=color:#ff79c6>97</span>: <span style=color:#bd93f9>2</span>
<span style=color:#ff79c6>98</span>: <span style=color:#bd93f9>1</span>
</code></pre></div><p>9 hour ranger roll (<code>500054</code> rolls in <code>548m</code>)</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>75</span>: <span style=color:#bd93f9>32296</span>
<span style=color:#ff79c6>76</span>: <span style=color:#bd93f9>37790</span>
<span style=color:#ff79c6>77</span>: <span style=color:#bd93f9>43118</span>
<span style=color:#ff79c6>78</span>: <span style=color:#bd93f9>46609</span>
<span style=color:#ff79c6>79</span>: <span style=color:#bd93f9>48108</span>
<span style=color:#ff79c6>80</span>: <span style=color:#bd93f9>47589</span>
<span style=color:#ff79c6>81</span>: <span style=color:#bd93f9>45774</span>
<span style=color:#ff79c6>82</span>: <span style=color:#bd93f9>41963</span>
<span style=color:#ff79c6>83</span>: <span style=color:#bd93f9>36876</span>
<span style=color:#ff79c6>84</span>: <span style=color:#bd93f9>30973</span>
<span style=color:#ff79c6>85</span>: <span style=color:#bd93f9>25272</span>
<span style=color:#ff79c6>86</span>: <span style=color:#bd93f9>19904</span>
<span style=color:#ff79c6>87</span>: <span style=color:#bd93f9>14730</span>
<span style=color:#ff79c6>88</span>: <span style=color:#bd93f9>10430</span>
<span style=color:#ff79c6>89</span>: <span style=color:#bd93f9>7285</span>
<span style=color:#ff79c6>90</span>: <span style=color:#bd93f9>4667</span>
<span style=color:#ff79c6>91</span>: <span style=color:#bd93f9>2991</span>
<span style=color:#ff79c6>92</span>: <span style=color:#bd93f9>1696</span>
<span style=color:#ff79c6>93</span>: <span style=color:#bd93f9>986</span>
<span style=color:#ff79c6>94</span>: <span style=color:#bd93f9>529</span>
<span style=color:#ff79c6>95</span>: <span style=color:#bd93f9>254</span>
<span style=color:#ff79c6>96</span>: <span style=color:#bd93f9>121</span>
<span style=color:#ff79c6>97</span>: <span style=color:#bd93f9>56</span>
<span style=color:#ff79c6>98</span>: <span style=color:#bd93f9>26</span>
<span style=color:#ff79c6>99</span>: <span style=color:#bd93f9>10</span>
<span style=color:#ff79c6>100</span>: <span style=color:#bd93f9>1</span>
</code></pre></div></p>
</details>
<details><summary style=cursor:pointer><b>2. Tabulated values for 18 dice multinomial probability distribution</b></summary>
<p>
<p><a href="https://www.wolframalpha.com/input?i2d=true&i=+Divide%5B1%2CPower%5B6%2C18%5D%5DSum%5BPower%5B%5C%2840%29-1%5C%2841%29%2Ck%5D+*binomial%5C%2840%2918%5C%2844%29+k%5C%2841%29*binomial%5C%2840%2991-6k-1%5C%2844%29+17%5C%2841%29%2C%7Bk%2C0%2Cfloor%5C%2840%29Divide%5B%5C%2840%2991-18%5C%2841%29%2C6%5D%5C%2841%29%7D%5D">Wolfram Alpha Query</a></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>18  </span>: <span style=color:#bd93f9>1</span>/101559956668416
<span style=color:#ff79c6>19  </span>: <span style=color:#bd93f9>1</span>/5642219814912
<span style=color:#ff79c6>20  </span>: <span style=color:#bd93f9>19</span>/11284439629824
<span style=color:#ff79c6>21  </span>: <span style=color:#bd93f9>95</span>/8463329722368
<span style=color:#ff79c6>22  </span>: <span style=color:#bd93f9>665</span>/11284439629824
<span style=color:#ff79c6>23  </span>: <span style=color:#bd93f9>1463</span>/5642219814912
<span style=color:#ff79c6>24  </span>: <span style=color:#bd93f9>33643</span>/33853318889472
<span style=color:#ff79c6>25  </span>: <span style=color:#bd93f9>9605</span>/2821109907456
<span style=color:#ff79c6>26  </span>: <span style=color:#bd93f9>119833</span>/11284439629824
<span style=color:#ff79c6>27  </span>: <span style=color:#bd93f9>1552015</span>/50779978334208
<span style=color:#ff79c6>28  </span>: <span style=color:#bd93f9>308465</span>/3761479876608
<span style=color:#ff79c6>29  </span>: <span style=color:#bd93f9>97223</span>/470184984576
<span style=color:#ff79c6>30  </span>: <span style=color:#bd93f9>2782169</span>/5642219814912
<span style=color:#ff79c6>31  </span>: <span style=color:#bd93f9>1051229</span>/940369969152
<span style=color:#ff79c6>32  </span>: <span style=color:#bd93f9>4550747</span>/1880739938304
<span style=color:#ff79c6>33  </span>: <span style=color:#bd93f9>786505</span>/156728328192
<span style=color:#ff79c6>34  </span>: <span style=color:#bd93f9>37624655</span>/3761479876608
<span style=color:#ff79c6>35  </span>: <span style=color:#bd93f9>36131483</span>/1880739938304
<span style=color:#ff79c6>36  </span>: <span style=color:#bd93f9>1206294965</span>/33853318889472
<span style=color:#ff79c6>37  </span>: <span style=color:#bd93f9>20045551</span>/313456656384
<span style=color:#ff79c6>38  </span>: <span style=color:#bd93f9>139474379</span>/1253826625536
<span style=color:#ff79c6>39  </span>: <span style=color:#bd93f9>1059736685</span>/5642219814912
<span style=color:#ff79c6>40  </span>: <span style=color:#bd93f9>128825225</span>/417942208512
<span style=color:#ff79c6>41  </span>: <span style=color:#bd93f9>17143871</span>/34828517376
<span style=color:#ff79c6>42  </span>: <span style=color:#bd93f9>8640663457</span>/11284439629824
<span style=color:#ff79c6>43  </span>: <span style=color:#bd93f9>728073331</span>/626913312768
<span style=color:#ff79c6>44  </span>: <span style=color:#bd93f9>2155134523</span>/1253826625536
<span style=color:#ff79c6>45  </span>: <span style=color:#bd93f9>3942228889</span>/1586874322944
<span style=color:#ff79c6>46  </span>: <span style=color:#bd93f9>4949217565</span>/1410554953728
<span style=color:#ff79c6>47  </span>: <span style=color:#bd93f9>3417441745</span>/705277476864
<span style=color:#ff79c6>48  </span>: <span style=color:#bd93f9>27703245169</span>/4231664861184
<span style=color:#ff79c6>49  </span>: <span style=color:#bd93f9>3052981465</span>/352638738432
<span style=color:#ff79c6>50  </span>: <span style=color:#bd93f9>126513483013</span>/11284439629824
<span style=color:#ff79c6>51  </span>: <span style=color:#bd93f9>240741263447</span>/16926659444736
<span style=color:#ff79c6>52  </span>: <span style=color:#bd93f9>199524184055</span>/11284439629824
<span style=color:#ff79c6>53  </span>: <span style=color:#bd93f9>60788736553</span>/2821109907456
<span style=color:#ff79c6>54  </span>: <span style=color:#bd93f9>2615090074301</span>/101559956668416
<span style=color:#ff79c6>55  </span>: <span style=color:#bd93f9>56759069113</span>/1880739938304
<span style=color:#ff79c6>56  </span>: <span style=color:#bd93f9>130521904423</span>/3761479876608
<span style=color:#ff79c6>57  </span>: <span style=color:#bd93f9>110438453753</span>/2821109907456
<span style=color:#ff79c6>58  </span>: <span style=color:#bd93f9>163027882055</span>/3761479876608
<span style=color:#ff79c6>59  </span>: <span style=color:#bd93f9>88576807769</span>/1880739938304
<span style=color:#ff79c6>60  </span>: <span style=color:#bd93f9>566880747559</span>/11284439629824
<span style=color:#ff79c6>61  </span>: <span style=color:#bd93f9>24732579319</span>/470184984576
<span style=color:#ff79c6>62  </span>: <span style=color:#bd93f9>101698030955</span>/1880739938304
<span style=color:#ff79c6>63  </span>: <span style=color:#bd93f9>461867856157</span>/8463329722368
<span style=color:#ff79c6>64  </span>: <span style=color:#bd93f9>101698030955</span>/1880739938304
<span style=color:#ff79c6>65  </span>: <span style=color:#bd93f9>24732579319</span>/470184984576
<span style=color:#ff79c6>66  </span>: <span style=color:#bd93f9>566880747559</span>/11284439629824
<span style=color:#ff79c6>67  </span>: <span style=color:#bd93f9>88576807769</span>/1880739938304
<span style=color:#ff79c6>68  </span>: <span style=color:#bd93f9>163027882055</span>/3761479876608
<span style=color:#ff79c6>69  </span>: <span style=color:#bd93f9>110438453753</span>/2821109907456
<span style=color:#ff79c6>70  </span>: <span style=color:#bd93f9>130521904423</span>/3761479876608
<span style=color:#ff79c6>71  </span>: <span style=color:#bd93f9>56759069113</span>/1880739938304
<span style=color:#ff79c6>72  </span>: <span style=color:#bd93f9>2615090074301</span>/101559956668416
<span style=color:#ff79c6>73  </span>: <span style=color:#bd93f9>60788736553</span>/2821109907456
<span style=color:#ff79c6>74  </span>: <span style=color:#bd93f9>199524184055</span>/11284439629824
<span style=color:#ff79c6>75  </span>: <span style=color:#bd93f9>240741263447</span>/16926659444736
<span style=color:#ff79c6>76  </span>: <span style=color:#bd93f9>126513483013</span>/11284439629824
<span style=color:#ff79c6>77  </span>: <span style=color:#bd93f9>3052981465</span>/352638738432
<span style=color:#ff79c6>78  </span>: <span style=color:#bd93f9>27703245169</span>/4231664861184
<span style=color:#ff79c6>79  </span>: <span style=color:#bd93f9>3417441745</span>/705277476864
<span style=color:#ff79c6>80  </span>: <span style=color:#bd93f9>4949217565</span>/1410554953728
<span style=color:#ff79c6>81  </span>: <span style=color:#bd93f9>3942228889</span>/1586874322944
<span style=color:#ff79c6>82  </span>: <span style=color:#bd93f9>2155134523</span>/1253826625536
<span style=color:#ff79c6>83  </span>: <span style=color:#bd93f9>728073331</span>/626913312768
<span style=color:#ff79c6>84  </span>: <span style=color:#bd93f9>8640663457</span>/11284439629824
<span style=color:#ff79c6>85  </span>: <span style=color:#bd93f9>17143871</span>/34828517376
<span style=color:#ff79c6>86  </span>: <span style=color:#bd93f9>128825225</span>/417942208512
<span style=color:#ff79c6>87  </span>: <span style=color:#bd93f9>1059736685</span>/5642219814912
<span style=color:#ff79c6>88  </span>: <span style=color:#bd93f9>139474379</span>/1253826625536
<span style=color:#ff79c6>89  </span>: <span style=color:#bd93f9>20045551</span>/313456656384
<span style=color:#ff79c6>90  </span>: <span style=color:#bd93f9>1206294965</span>/33853318889472
<span style=color:#ff79c6>91  </span>: <span style=color:#bd93f9>36131483</span>/1880739938304
<span style=color:#ff79c6>92  </span>: <span style=color:#bd93f9>37624655</span>/3761479876608
<span style=color:#ff79c6>93  </span>: <span style=color:#bd93f9>786505</span>/156728328192
<span style=color:#ff79c6>94  </span>: <span style=color:#bd93f9>4550747</span>/1880739938304
<span style=color:#ff79c6>95  </span>: <span style=color:#bd93f9>1051229</span>/940369969152
<span style=color:#ff79c6>96  </span>: <span style=color:#bd93f9>2782169</span>/5642219814912
<span style=color:#ff79c6>97  </span>: <span style=color:#bd93f9>97223</span>/470184984576
<span style=color:#ff79c6>98  </span>: <span style=color:#bd93f9>308465</span>/3761479876608
<span style=color:#ff79c6>99  </span>: <span style=color:#bd93f9>1552015</span>/50779978334208
<span style=color:#ff79c6>100 </span>: <span style=color:#bd93f9>119833</span>/11284439629824
<span style=color:#ff79c6>101 </span>: <span style=color:#bd93f9>9605</span>/2821109907456
<span style=color:#ff79c6>102 </span>: <span style=color:#bd93f9>33643</span>/33853318889472
<span style=color:#ff79c6>103 </span>: <span style=color:#bd93f9>1463</span>/5642219814912
<span style=color:#ff79c6>104 </span>: <span style=color:#bd93f9>665</span>/11284439629824
<span style=color:#ff79c6>105 </span>: <span style=color:#bd93f9>95</span>/8463329722368
<span style=color:#ff79c6>106 </span>: <span style=color:#bd93f9>19</span>/11284439629824
<span style=color:#ff79c6>107 </span>: <span style=color:#bd93f9>1</span>/5642219814912
<span style=color:#ff79c6>108 </span>: <span style=color:#bd93f9>1</span>/101559956668416
</code></pre></div></p>
</details>
<details><summary style=cursor:pointer><b>3. Tabulated values for 3 dice multinomial probability distribution</b></summary>
<p>
<p><a href="https://www.wolframalpha.com/input?i2d=true&i=+Divide%5B1%2CPower%5B6%2C3%5D%5DSum%5BPower%5B%5C%2840%29-1%5C%2841%29%2Ck%5D+*binomial%5C%2840%293%5C%2844%29+k%5C%2841%29*binomial%5C%2840%2910-6k-1%5C%2844%29+2%5C%2841%29%2C%7Bk%2C0%2Cfloor%5C%2840%29Divide%5B%5C%2840%2910-3%5C%2841%29%2C6%5D%5C%2841%29%7D%5D">Wolfram Alpha Query</a></p>
<pre><code class=language-yaml: data-lang=yaml:>3: 1/216
4: 1/72
5: 1/36
6: 5/108
7: 5/72
8: 7/72
9: 25/216
10: 1/8
11: 1/8
12: 25/216
13: 7/72
14: 5/72
15: 5/108
16: 1/36
17: 1/72
18: 1/216
</code></pre></p>
</details>
<details><summary style=cursor:pointer><b>4. Comparing observed vs. computed by class</b></summary>
<p>
We compare with the precise $Z_{class}$ distributions worked out by convolution above.
<div id=probhistappdxpala style=width:600px;height:450px></div>
<script>var data=[trace_trunconv_paladin,trace_obs_paladin],layout={title:"Theoretical vs Observed Distributions for Paladin",xaxis:{title:"Roll"},yaxis:{title:"Probability"}};Plotly.newPlot(document.getElementById('probhistappdxpala'),data,layout)</script>
<div id=probhistappdxrang style=width:600px;height:450px></div>
<script>var data=[trace_trunconv_ranger,trace_obs_ranger],layout={title:"Theoretical vs Observed Distributions for Ranger",xaxis:{title:"Roll"},yaxis:{title:"Probability"}};Plotly.newPlot(document.getElementById('probhistappdxrang'),data,layout)</script>
<p>For fighter we have included the original uncorrected multinomial distribution for 18 dice before doing simulations. It was sufficiently close to the true distribution because flooring a single ability to <code>9</code> amounts to almost nothing in the right tail:</p>
<div id=probhistappdxfig style=width:600px;height:450px></div>
<script>var data=[trace_trunconv_fighter,trace_obs_fighter,trace_single_trunc],layout={title:"Theoretical vs Observed Distributions for Fighter",xaxis:{title:"Roll"},yaxis:{title:"Probability"}};Plotly.newPlot(document.getElementById('probhistappdxfig'),data,layout)</script>
<p>That said, the true distribution taking into account the single floored stat has a much better fit.</p>
</p>
</details>
<details><summary style=cursor:pointer><b>5. Normal approximations</b></summary>
<p>
<p>An original idea here was to avoid doing all the faff with convolution above, and &ldquo;just&rdquo; approximate the distribution with some normal $\mathcal{N}(μ, σ)$.</p>
<p>After all, <a href=https://mathworld.wolfram.com/Dice.html>this is suggested for high n</a>, and it will hold even for an unequal <a href=https://en.wikipedia.org/wiki/Central_limit_theorem>sum of independent random variables with sufficient degrees of freedom</a>.</p>
<p>However, there are many <strong>complications</strong> with this approach:</p>
<ul>
<li>we only <strong>sample</strong> the <strong>doubly censored data</strong>, we don&rsquo;t see the full normal distribution</li>
<li><strong>distributions</strong> are heavily <strong>shifted</strong> (as can be seen with the true paladin distribution)</li>
<li>estimation of underlying normal distribution relies difficult for classes whose means precedes the truncation point</li>
</ul>
<p>It does looks like there are tools to work with truncated or rectified normals:</p>
<ul>
<li>extension methods for <a href=https://en.wikipedia.org/wiki/Rectified_Gaussian_distribution#Extension_to_general_bounds>rectified normal distributions</a></li>
<li><a href=https://en.wikipedia.org/wiki/Truncated_normal_distribution#One_sided_truncation_(of_lower_tail)>formulas for dealing with truncation of a normal distributions</a></li>
<li><a href=https://rdrr.io/cran/crch/man/cnorm.html>cnorm r library</a> which comes with a <a href=https://cran.r-project.org/web/packages/cNORM/cNORM.pdf>giant pdf</a> as documentation to help remind you of why we need rustdoc</li>
</ul>
<p>But this felt like the wrong path to descend, and the path was littered with arcana:</p>
<blockquote class=twitter-tweet data-dnt=true data-theme=light><p lang=en dir=ltr>ah, yes, just a vector. <a href=https://t.co/RvkpS4h0DX>pic.twitter.com/RvkpS4h0DX</a></p>&mdash; eirik ᐸ'⧖ᐳ (@sszynrae) <a href="https://twitter.com/sszynrae/status/1512161877698174983?ref_src=twsrc%5Etfw">April 7, 2022</a></blockquote> <script async src=https://platform.twitter.com/widgets.js></script>
<p>That said. If anyone wants to fill in something here, or link to alternate methods, feel free to PR in something <a href=https://github.com/clux/probes/edit/master/content/post/2022-04-12-baldurs-roll.md>here</a> or write an <a href=https://github.com/clux/probes/issues>issue</a>.</p>
</p>
</details>
<div class=blog-tags>
<a href=https://clux.dev//tags/math/>math</a>&nbsp;
</div>
<h4 class=see-also>See also</h4>
<ul>
<li><a href=https://clux.dev/post/2011-03-20-tournament-seeding-placement/>Tournament Seeding Placement</a></li>
<li><a href=https://clux.dev/post/2006-08-09-vault-of-therayne/>Vault of Therayne</a></li>
</ul>
</article>
<ul class="pager blog-pager">
<li class=previous>
<a href=https://clux.dev/post/2022-01-11-prometheus-ecosystem/ data-toggle=tooltip data-placement=top title="Prometheus Stack Review">&larr; Previous Post</a>
</li>
<li class=next>
<a href=https://clux.dev/post/2022-10-31-factober/ data-toggle=tooltip data-placement=top title="Factober 5400">Next Post &rarr;</a>
</li>
</ul>
</div>
</div>
</div>
<footer>
<div class=container>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<ul class="list-inline text-center footer-links">
<li>
<a href=mailto:sszynrae@gmail.com title="Email me">
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://github.com/clux title=GitHub>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://reddit.com/u/clux title=Reddit>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-reddit-alien fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://linkedin.com/in/%f0%9f%97%91-eirik-albrigtsen-b279863a title=LinkedIn>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://www.youtube.com/channel/UCLpykMxkxuPUR9CciheipZg title=Youtube>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-youtube fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://www.strava.com/athletes/49770219 title=strava>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-strava fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
</ul>
<p class="credits copyright text-muted">
clux
&nbsp;&bull;&nbsp;&copy;
2022
&nbsp;&bull;&nbsp;
<a href=https://clux.dev/>probes</a>
</p>
<p class="credits theme-by text-muted">
<a href=https://gohugo.io>Hugo v0.87.0</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a>
&nbsp;&bull;&nbsp;[<a href=937221c4df78fb746d826293e4b1c55240103787>937221c4</a>]
</p>
</div>
</div>
</div>
</footer><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script src=https://clux.dev/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://clux.dev/js/load-photoswipe.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script>
<script>renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})</script>
</body>
</html>