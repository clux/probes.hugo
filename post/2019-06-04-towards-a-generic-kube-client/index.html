<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>A generic kubernetes client - probes</title><meta property=og:title content="A generic kubernetes client"><meta name=twitter:title content="A generic kubernetes client"><meta name=description content="Shaving a yak for a client-rust"><meta property=og:description content="Shaving a yak for a client-rust"><meta name=twitter:description content="Shaving a yak for a client-rust"><meta name=author content=clux><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"probes","url":"https://clux.github.io/probes/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https://clux.github.io/probes/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://clux.github.io/probes/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https://clux.github.io/probes/post/2019-06-04-towards-a-generic-kube-client/","name":"A generic kubernetes client"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"clux"},"headline":"A generic kubernetes client","description":"It&amp;rsquo;s been about a month since we released kube, a new rust client library for kubernetes. We covered the initial release, but it was full of naive optimism and uncertainty. Would the generic setup work with native objects? How far would it extend? Non-standard objects? Patch handling? Event handling? Surely, it&amp;rsquo;d be a fools errand to write an entire client library?
With the last 0.10.0 release, it&amp;rsquo;s now clear that the generic setup extends quite far. Unfortunately, this yak is hairy, even by yak standards.
","inLanguage":"en","wordCount":1941,"datePublished":"2019-06-04T00:00:00","dateModified":"2019-06-04T00:00:00","image":"https://clux.github.io/probes/","keywords":["rust, kubernetes"],"mainEntityOfPage":"https://clux.github.io/probes/post/2019-06-04-towards-a-generic-kube-client/","publisher":{"@type":"Organization","name":"https://clux.github.io/probes/","logo":{"@type":"ImageObject","url":"https://clux.github.io/probes/","height":60,"width":60}}}</script><meta property=og:title content="A generic kubernetes client"><meta property=og:description content="Shaving a yak for a client-rust"><meta property=og:url content=https://clux.github.io/post/2019-06-04-towards-a-generic-kube-client/><meta property=og:type content=website><meta property=og:site_name content=probes><meta name=twitter:title content="A generic kubernetes client"><meta name=twitter:description content="Shaving a yak for a client-rust"><meta name=twitter:card content=summary><meta name=twitter:site content=@sszynrae><meta name=twitter:creator content=@sszynrae><meta name=twitter:card content=summary><meta name=twitter:site content=@sszynrae><meta name=twitter:creator content=@sszynrae><meta property=og:url content=https://clux.github.io/post/2019-06-04-towards-a-generic-kube-client/><meta property=og:type content=website><meta property=og:site_name content=probes><meta name=generator content="Hugo 0.52"><link rel=alternate href=https://clux.github.io/probes/index.xml type=application/rss+xml title=probes><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://clux.github.io/probes/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://clux.github.io/probes/css/syntax.css><link rel=stylesheet href=https://clux.github.io/probes/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=https://clux.github.io/probes/>probes</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Blog href=https://clux.github.io/probes/>Blog</a></li><li><a title=About href=https://clux.github.io/probes/page/about/>About</a></li><li><a title=Tags href=https://clux.github.io/probes/tags>Tags</a></li></ul></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>A generic kubernetes client</h1><h2 class=post-subheading>Shaving a yak for a client-rust</h2><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on June 4, 2019
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;clux</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>It&rsquo;s been about a month since we released <a href=https://github.com/clux/kube-rs><code>kube</code></a>, a new rust client library for kubernetes. We <a href=https://clux.github.io/probes/post/2019-04-29-rust-on-kubernetes>covered</a> the initial release, but it was full of naive optimism and uncertainty. Would the generic setup work with native objects? How far would it extend? Non-standard objects? Patch handling? Event handling? Surely, it&rsquo;d be a fools errand to write an entire client library?</p><p>With the last <code>0.10.0</code> release, it&rsquo;s now clear that the generic setup extends quite far. Unfortunately, this yak is hairy, even by yak standards.</p><h2 id=overview>Overview</h2><p>The reason this library even works at all, is the amount of homebrew generics present in the kubernetes API.</p><p>Thanks to the hard work of many kubernetes engineers, <strong>most</strong> API returns can be serialized into some wrapper around this struct:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#ff79c6>#[derive(Deserialize, Serialize, Clone)]</span>
<span style=color:#ff79c6>pub</span> <span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>Object</span><span style=color:#ff79c6>&lt;</span>T, U<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>where</span> T: <span style=color:#8be9fd;font-style:italic>Clone</span>, U: <span style=color:#8be9fd;font-style:italic>Clone</span>
{
    <span style=color:#ff79c6>#[serde(flatten)]</span>
    <span style=color:#ff79c6>pub</span> types: <span style=color:#50fa7b>TypeMeta</span>,
    <span style=color:#ff79c6>pub</span> metadata: <span style=color:#50fa7b>ObjectMeta</span>,
    <span style=color:#ff79c6>pub</span> spec: <span style=color:#50fa7b>T</span>,
    <span style=color:#ff79c6>#[serde(default, skip_serializing_if = </span><span style=color:#f1fa8c>&#34;Option::is_none&#34;</span><span style=color:#ff79c6>)]</span>
    <span style=color:#ff79c6>pub</span> status: <span style=color:#8be9fd;font-style:italic>Option</span><span style=color:#ff79c6>&lt;</span>U<span style=color:#ff79c6>&gt;</span>,
}
</code></pre></div><p>You can infer a lot of the inner api workings by looking at <a href=https://github.com/kubernetes/apimachinery/blob/master/pkg/apis/meta/v1/types.go>apimachinery/meta/types.go</a>. Kris Nova&rsquo;s 2019 FOSDEM talk on <a href=https://fosdem.org/2019/schedule/event/kubernetesclusterfuck/>the internal clusterfuck of kubernetes</a> also provides a much welcome, rant-flavoured context.</p><p>By taking advantage of this, we can provide a much simpler interface to what the generated openapi bindings can provide. But it requires some other abstractions:</p><h2 id=more-object-patterns>More object patterns</h2><p>Let&rsquo;s compare some openapi generated structs:</p><ul><li><a href=https://docs.rs/k8s-openapi/0.4.0/k8s_openapi/api/core/v1/struct.PodList.html>PodList</a></li><li><a href=https://docs.rs/k8s-openapi/0.4.0/k8s_openapi/api/core/v1/struct.NodeList.html>NodeList</a></li><li><a href=https://docs.rs/k8s-openapi/0.4.0/k8s_openapi/api/apps/v1/struct.DeploymentList.html>DeploymentList</a></li></ul><p>All with identical contents. You could just define this generic struct:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#ff79c6>#[derive(Deserialize)]</span>
<span style=color:#ff79c6>pub</span> <span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>ObjectList</span><span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>where</span>
  T: <span style=color:#8be9fd;font-style:italic>Clone</span>
{
    <span style=color:#ff79c6>pub</span> metadata: <span style=color:#50fa7b>ListMeta</span>,
    <span style=color:#ff79c6>#[serde(bound(deserialize = </span><span style=color:#f1fa8c>&#34;Vec&lt;T&gt;: Deserialize&lt;&#39;de&gt;&#34;</span><span style=color:#ff79c6>))]</span>
    <span style=color:#ff79c6>pub</span> items: <span style=color:#8be9fd;font-style:italic>Vec</span><span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;</span>,
}
</code></pre></div><p>Similarly, the query parameters optionals structs:</p><ul><li><a href=https://docs.rs/k8s-openapi/0.4.0/k8s_openapi/api/core/v1/struct.ListNodeOptional.html>ListNodeOptional</a></li><li><a href=https://docs.rs/k8s-openapi/0.4.0/k8s_openapi/api/core/v1/struct.ListPodForAllNamespacesOptional.html>ListPodForAllNamespacesOptional</a></li><li><a href=https://docs.rs/k8s-openapi/0.4.0/k8s_openapi/api/apps/v1/struct.ListDeploymentForAllNamespacesOptional.html>ListDeploymentForAllNamespacesOptional</a></li></ul><p>These are a mouthful. And again, almost all of them have the same fields. Not going to go through the whole setup here, because the TL;DR is that once you build everything with the <code>types.go</code> assumptions in mind, a lot just falls into place and we can write our own generic api machinery.</p><h2 id=api-machinery>Api machinery</h2><p>If you follow this rabbit hole, you can end up with the following type signatures:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#ff79c6>impl</span><span style=color:#ff79c6>&lt;</span>K<span style=color:#ff79c6>&gt;</span> Api<span style=color:#ff79c6>&lt;</span>K<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>where</span>
    K: <span style=color:#8be9fd;font-style:italic>Clone</span> <span style=color:#ff79c6>+</span> DeserializeOwned <span style=color:#ff79c6>+</span> KubeObject
{
    <span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>get</span>(<span style=color:#ff79c6>&amp;</span>self, name: <span style=color:#ff79c6>&amp;</span><span style=color:#8be9fd>str</span>) -&gt; <span style=color:#8be9fd;font-style:italic>Result</span><span style=color:#ff79c6>&lt;</span>K<span style=color:#ff79c6>&gt;</span>;
    <span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>create</span>(<span style=color:#ff79c6>&amp;</span>self, pp: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>PostParams</span>, data: <span style=color:#8be9fd;font-style:italic>Vec</span><span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>u8</span><span style=color:#ff79c6>&gt;</span>) -&gt; <span style=color:#8be9fd;font-style:italic>Result</span><span style=color:#ff79c6>&lt;</span>K<span style=color:#ff79c6>&gt;</span>;
    <span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>patch</span>(<span style=color:#ff79c6>&amp;</span>self, name: <span style=color:#ff79c6>&amp;</span><span style=color:#8be9fd>str</span>, pp: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>PostParams</span>, patch: <span style=color:#8be9fd;font-style:italic>Vec</span><span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>u8</span><span style=color:#ff79c6>&gt;</span>) -&gt; <span style=color:#8be9fd;font-style:italic>Result</span><span style=color:#ff79c6>&lt;</span>K<span style=color:#ff79c6>&gt;</span>;
    <span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>replace</span>(<span style=color:#ff79c6>&amp;</span>self, name: <span style=color:#ff79c6>&amp;</span><span style=color:#8be9fd>str</span>, pp: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>PostParams</span>, data: <span style=color:#8be9fd;font-style:italic>Vec</span><span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>u8</span><span style=color:#ff79c6>&gt;</span>) -&gt; <span style=color:#8be9fd;font-style:italic>Result</span><span style=color:#ff79c6>&lt;</span>K<span style=color:#ff79c6>&gt;</span>;
    <span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>watch</span>(<span style=color:#ff79c6>&amp;</span>self, lp: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>ListParams</span>, version: <span style=color:#ff79c6>&amp;</span><span style=color:#8be9fd>str</span>) -&gt; <span style=color:#8be9fd;font-style:italic>Result</span><span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd;font-style:italic>Vec</span><span style=color:#ff79c6>&lt;</span>WatchEvent<span style=color:#ff79c6>&lt;</span>P, U<span style=color:#ff79c6>&gt;&gt;&gt;</span>;
    <span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>list</span>(<span style=color:#ff79c6>&amp;</span>self, lp: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>ListParams</span>) -&gt; <span style=color:#8be9fd;font-style:italic>Result</span><span style=color:#ff79c6>&lt;</span>ObjectList<span style=color:#ff79c6>&lt;</span>K<span style=color:#ff79c6>&gt;&gt;</span>;
    <span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>delete_collection</span>(<span style=color:#ff79c6>&amp;</span>self, lp: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>ListParams</span>) -&gt; <span style=color:#8be9fd;font-style:italic>Result</span><span style=color:#ff79c6>&lt;</span>Either<span style=color:#ff79c6>&lt;</span>ObjectList<span style=color:#ff79c6>&lt;</span>K<span style=color:#ff79c6>&gt;</span>, Status<span style=color:#ff79c6>&gt;&gt;</span>;
    <span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>delete</span>(<span style=color:#ff79c6>&amp;</span>self, name: <span style=color:#ff79c6>&amp;</span><span style=color:#8be9fd>str</span>, dp: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>DeleteParams</span>) -&gt; <span style=color:#8be9fd;font-style:italic>Result</span><span style=color:#ff79c6>&lt;</span>Either<span style=color:#ff79c6>&lt;</span>K, Status<span style=color:#ff79c6>&gt;&gt;</span>;

    <span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>get_status</span>(<span style=color:#ff79c6>&amp;</span>self, name: <span style=color:#ff79c6>&amp;</span><span style=color:#8be9fd>str</span>) -&gt; <span style=color:#8be9fd;font-style:italic>Result</span><span style=color:#ff79c6>&lt;</span>K<span style=color:#ff79c6>&gt;</span>;
    <span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>patch_status</span>(<span style=color:#ff79c6>&amp;</span>self, name: <span style=color:#ff79c6>&amp;</span><span style=color:#8be9fd>str</span>, pp: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>PostParams</span>, patch: <span style=color:#8be9fd;font-style:italic>Vec</span><span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>u8</span><span style=color:#ff79c6>&gt;</span>) -&gt;<span style=color:#8be9fd;font-style:italic>Result</span><span style=color:#ff79c6>&lt;</span>K<span style=color:#ff79c6>&gt;</span>;
    <span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>replace_status</span>(<span style=color:#ff79c6>&amp;</span>self, name: <span style=color:#ff79c6>&amp;</span><span style=color:#8be9fd>str</span>, pp: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>PostParams</span>, data: <span style=color:#8be9fd;font-style:italic>Vec</span><span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>u8</span><span style=color:#ff79c6>&gt;</span>) -&gt; <span style=color:#8be9fd;font-style:italic>Result</span><span style=color:#ff79c6>&lt;</span>K<span style=color:#ff79c6>&gt;</span>;
}
</code></pre></div><p>These are the <em>main</em> query methods on our core <code>Api</code> (<a href=https://clux.github.io/kube-rs/kube/api/struct.Api.html>docs</a> / <a href=https://github.com/clux/kube-rs/blob/master/src/api/typed.rs>src</a>). Observe that similar types of requests take the same <code>*Params</code> objects to configure queries. Return types have clear patterns, and serialization happens before entering the <code>Api</code>.</p><p>There&rsquo;s is no hidden de-multiplexing on the parsing side. When calling <code>list</code>, we just <a href=https://turbo.fish/>turbofish</a> that type in for <code>serde</code> to deal with internally:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust>self.client.request::<span style=color:#ff79c6>&lt;</span>ObjectList<span style=color:#ff79c6>&lt;</span>K<span style=color:#ff79c6>&gt;&gt;</span>(req)
</code></pre></div><p>Where, typically <code>K = Object&lt;P, U&gt;</code>, but actually; <code>K</code> is something implementing a <code>KubeObject</code> trait. This is our one required trait, and you shouldn&rsquo;t don&rsquo;t have to deal with it because of an automatic blanket implementation for <code>K = Object&lt;P, U&gt;</code>.</p><h3 id=client-go-semantics>client-go semantics</h3><p>While it might not seem like it with all this talk about generics; we are actually trying to model things a little closer to <code>client-go</code> and internal kube <code>apimachinery</code> (insofar as it makes sense).</p><p>Just have a look at how <code>client-go</code> presents <a href=https://github.com/kubernetes/client-go/blob/7b18d6600f6b0022e31c46b46875beffd85cc71a/kubernetes/typed/core/v1/pod.go#L39-L50>Pod objects</a> or <a href=https://github.com/kubernetes/client-go/blob/e65ca70987a6941be583f205696e0b1b7da82002/kubernetes/typed/extensions/v1beta1/deployment.go#L39-L53>Deployment objects</a>. There&rsquo;s already a pretty clear overlap with the above signatures.</p><p>Maybe you are in the camp with <code>Bryan Liles</code>, who said that <a href="https://youtu.be/Rbe0eNXqCoA?t=563">&ldquo;client-go is not for mortals&rdquo;</a> during his kubecon 2019 keynote. It&rsquo;s certainly a large library (sitting at ~80k lines of mostly go), but amongst the <a href=https://godoc.org/k8s.io/client-go/tools/cache>somewhat cruft-filled chunks</a>, it does embed some <a href=https://godoc.org/k8s.io/client-go/util/retry#RetryOnConflict>really interesting patterns</a> to consider.</p><p>The terminology in this library should therefore be a lot more familiar now. Not only are using ideas from <code>client-go</code>, our core assumptions come from <a href=https://kubernetes.io/docs/reference/using-api/api-concepts/>api-concepts</a>, and we otherwise try to take inspiration from frameworks such as <a href=https://book.kubebuilder.io/>kubebuilder</a>. That said, we are inevitably going to hit some walls when kubernetes isn&rsquo;t as generic as we inadvertently promised it to be.</p><p>But delay that tale; let&rsquo;s first look at how to use the <code>Api</code>:</p><h2 id=api-usage>Api Usage</h2><p>Using the <code>Api</code> now amounts to choosing one of the constructors for the native / custom type(s) you want and use with the verbs listed above.</p><p>For <code>Pod</code> objects, you can construct and use such an object like:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#8be9fd;font-style:italic>let</span> pods <span style=color:#ff79c6>=</span> Api::v1Pod(client).within(<span style=color:#f1fa8c>&#34;kube-system&#34;</span>);
<span style=color:#ff79c6>for</span> p <span style=color:#ff79c6>in</span> pods.list(<span style=color:#ff79c6>&amp;</span>ListParams::default())<span style=color:#ff79c6>?</span>.items {
    println<span style=color:#ff79c6>!</span>(<span style=color:#f1fa8c>&#34;Got Pod: {}&#34;</span>, p.metadata.name);
}
</code></pre></div><p>Here the <code>p</code> is an <code>Object&lt;PodSpec, PodStatus&gt;</code>. This leverages <code>k8s-openapi</code> for <a href=https://docs.rs/k8s-openapi/0.4.0/k8s_openapi/api/core/v1/struct.PodSpec.html>PodSpec</a> and <a href=https://docs.rs/k8s-openapi/0.4.0/k8s_openapi/api/core/v1/struct.PodStatus.html>PodStatus</a> as the source of these large types.</p><p>If needed, you <a href=https://github.com/clux/kube-rs#raw-api>can define these structs yourself</a>, but as an example, let&rsquo;s show how that plays in with <a href=https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/>CRDs</a>; because custom resources require you to define everything about them anyway.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#ff79c6>#[derive(Deserialize, Serialize, Clone)]</span>
<span style=color:#ff79c6>pub</span> <span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>FooSpec</span> {
    name: <span style=color:#8be9fd;font-style:italic>String</span>,
    info: <span style=color:#8be9fd;font-style:italic>String</span>,
}

<span style=color:#ff79c6>#[derive(Deserialize, Serialize, Clone, Debug, Default)]</span>
<span style=color:#ff79c6>pub</span> <span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>FooStatus</span> {
    isBad: <span style=color:#8be9fd>bool</span>,
}

<span style=color:#ff79c6>type</span> <span style=color:#50fa7b>Foo</span> <span style=color:#ff79c6>=</span> Object<span style=color:#ff79c6>&lt;</span>FooSpec, FooStatus<span style=color:#ff79c6>&gt;</span>;
</code></pre></div><p>This is all you need to get your &ldquo;code generation&rdquo;. No external tools to shell out to; <code>cargo build</code> gives you your json serialization/deserialization, and the generic <code>Api</code> gives you your api machinery.</p><p>You can therefore interact with your <code>customResource</code> as follows:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#8be9fd;font-style:italic>let</span> foos : <span style=color:#50fa7b>Api</span><span style=color:#ff79c6>&lt;</span>Foo<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>=</span> Api::customResource(client, <span style=color:#f1fa8c>&#34;foos&#34;</span>)
    .version(<span style=color:#f1fa8c>&#34;v1&#34;</span>)
    .group(<span style=color:#f1fa8c>&#34;clux.dev&#34;</span>)
    .within(<span style=color:#f1fa8c>&#34;default&#34;</span>);

<span style=color:#8be9fd;font-style:italic>let</span> baz <span style=color:#ff79c6>=</span> foos.get(<span style=color:#f1fa8c>&#34;baz&#34;</span>)<span style=color:#ff79c6>?</span>;
assert_eq<span style=color:#ff79c6>!</span>(baz.spec.info, <span style=color:#f1fa8c>&#34;baz info&#34;</span>);
</code></pre></div><p>Here we are fetching and parsing straight into the <code>Foo</code> object on <code>.get()</code>.</p><p>So what about posting and patching? For brevity, let&rsquo;s use the <a href=https://docs.serde.rs/serde_json/macro.json.html>serde_json macro</a>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#8be9fd;font-style:italic>let</span> f <span style=color:#ff79c6>=</span> json<span style=color:#ff79c6>!</span>({
    <span style=color:#f1fa8c>&#34;apiVersion&#34;</span>: <span style=color:#f1fa8c>&#34;clux.dev/v1&#34;</span>,
    <span style=color:#f1fa8c>&#34;kind&#34;</span>: <span style=color:#f1fa8c>&#34;Foo&#34;</span>,
    <span style=color:#f1fa8c>&#34;metadata&#34;</span>: { <span style=color:#f1fa8c>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;baz&#34;</span> },
    <span style=color:#f1fa8c>&#34;spec&#34;</span>: { <span style=color:#f1fa8c>&#34;name&#34;</span>: <span style=color:#f1fa8c>&#34;baz&#34;</span>, <span style=color:#f1fa8c>&#34;info&#34;</span>: <span style=color:#f1fa8c>&#34;baz info&#34;</span> },
});
<span style=color:#8be9fd;font-style:italic>let</span> o <span style=color:#ff79c6>=</span> foos.create(<span style=color:#ff79c6>&amp;</span>pp, serde_json::to_vec(<span style=color:#ff79c6>&amp;</span>f)<span style=color:#ff79c6>?</span>)<span style=color:#ff79c6>?</span>;
assert_eq<span style=color:#ff79c6>!</span>(f[<span style=color:#f1fa8c>&#34;metadata&#34;</span>][<span style=color:#f1fa8c>&#34;name&#34;</span>], o.metadata.name)
</code></pre></div><p>Easy enough, if <a href=https://github.com/clux/kube-rs/issues/31>a tad verbose</a>. What about a <a href=https://kubernetes.io/docs/tasks/run-application/update-api-object-kubectl-patch/#alternate-forms-of-the-kubectl-patch-command>patch</a>?</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#8be9fd;font-style:italic>let</span> patch <span style=color:#ff79c6>=</span> json<span style=color:#ff79c6>!</span>({
    <span style=color:#f1fa8c>&#34;spec&#34;</span>: { <span style=color:#f1fa8c>&#34;info&#34;</span>: <span style=color:#f1fa8c>&#34;patched baz&#34;</span> }
});
<span style=color:#8be9fd;font-style:italic>let</span> o <span style=color:#ff79c6>=</span> foos.patch(<span style=color:#f1fa8c>&#34;baz&#34;</span>, <span style=color:#ff79c6>&amp;</span>pp, serde_json::to_vec(<span style=color:#ff79c6>&amp;</span>patch)<span style=color:#ff79c6>?</span>)<span style=color:#ff79c6>?</span>;
assert_eq<span style=color:#ff79c6>!</span>(o.spec.info, <span style=color:#f1fa8c>&#34;patched baz&#34;</span>);
</code></pre></div><p>Here <code>json!</code> really shines. The macro is actually also so context-aware, that you can reference variables, and even <a href=https://github.com/clux/kube-rs/blob/0b0ed4d2f035cf9e455f1ad8ae346cf87fc20cac/examples/crd_openapi.rs#L140-L146>attach structs to keys</a> within.</p><h2 id=higher-level-abstractions>Higher level abstractions</h2><p>With the core api abstractions in place, an easy abstraction is <code>Reflector&lt;K&gt;</code>: an automatic resource cache for a <code>K</code> which - through sustained <code>watch</code> calls - ensures its cache reflect the <code>etcd</code> state. We have <a href=https://clux.github.io/probes/post/2019-04-29-rust-on-kubernetes>talked about Reflectors earlier</a>; so let&rsquo;s cover Informers.</p><h3 id=informers>Informers</h3><p>An informer for a resource is an event notifier for that resource. It calls <code>watch</code> when you ask it to, and it informs you of new events. In go, you <a href=https://engineering.bitnami.com/articles/a-deep-dive-into-kubernetes-controllers.html>attach event handler functions</a> to it. In rust, we just pattern match our <code>WatchEvent</code> enum directly for a similar effect:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>handle_nodes</span>(ev: <span style=color:#50fa7b>WatchEvent</span><span style=color:#ff79c6>&lt;</span>Node<span style=color:#ff79c6>&gt;</span>) -&gt; <span style=color:#8be9fd;font-style:italic>Result</span><span style=color:#ff79c6>&lt;</span>(), failure::Error<span style=color:#ff79c6>&gt;</span> {
    <span style=color:#ff79c6>match</span> ev {
        WatchEvent::Added(o) <span style=color:#ff79c6>=&gt;</span> {},
        WatchEvent::Modified(o) <span style=color:#ff79c6>=&gt;</span> {},
        WatchEvent::Deleted(o) <span style=color:#ff79c6>=&gt;</span> {},
        WatchEvent::Error(e) <span style=color:#ff79c6>=&gt;</span> {}
    }
    <span style=color:#8be9fd;font-style:italic>Ok</span>(())
}
</code></pre></div><p>The <code>o</code> being destructured here is an <code>Object&lt;NodeSpec, NodeStatus&gt;</code>. See <a href=https://github.com/clux/kube-rs/blob/master/examples/>informer examples</a> for doing something with the objects.</p><p>To actually initialize and drive a node informer, you can do something like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>main</span>() -&gt; <span style=color:#8be9fd;font-style:italic>Result</span><span style=color:#ff79c6>&lt;</span>(), failure::Error<span style=color:#ff79c6>&gt;</span> {
    <span style=color:#8be9fd;font-style:italic>let</span> config <span style=color:#ff79c6>=</span> config::load_kube_config().expect(<span style=color:#f1fa8c>&#34;failed to load kubeconfig&#34;</span>);
    <span style=color:#8be9fd;font-style:italic>let</span> client <span style=color:#ff79c6>=</span> APIClient::new(config);
    <span style=color:#8be9fd;font-style:italic>let</span> nodes <span style=color:#ff79c6>=</span> Api::v1Node(client);
    <span style=color:#8be9fd;font-style:italic>let</span> ni <span style=color:#ff79c6>=</span> Informer::new(nodes)
        .labels(<span style=color:#f1fa8c>&#34;role=worker&#34;</span>)
        .init()<span style=color:#ff79c6>?</span>;

    <span style=color:#ff79c6>loop</span> {
        ni.poll()<span style=color:#ff79c6>?</span>;

        <span style=color:#ff79c6>while</span> <span style=color:#8be9fd;font-style:italic>let</span> <span style=color:#8be9fd;font-style:italic>Some</span>(event) <span style=color:#ff79c6>=</span> ni.pop() {
            handle_nodes(event)<span style=color:#ff79c6>?</span>;
        }
    }
}
</code></pre></div><p>The harder parts typically come if you need a separate threads; like one to handle polling, one for handling events async, perhaps you are interacting with a set of threads in an tokio/actix runtime.</p><p>You <a href=https://cloud.google.com/blog/products/containers-kubernetes/best-practices-for-building-kubernetes-operators-and-stateful-apps>should handle these cases</a>, but it&rsquo;s thankfully, not hard. You can just give out a <code>clone</code> of your <code>Informer</code> to the runtime. The <a href=https://github.com/clux/controller-rs>controller-rs</a> example shows how trivial it is <a href=https://github.com/clux/controller-rs/blob/master/src/state.rs>to encapsulate an informer</a> and drive it <a href=https://github.com/clux/controller-rs/blob/5db6caca13f4a33d168c1abe7c94a02559d4f46e/src/main.rs#L20-L51>along actix</a> (using the 1.0.0 rc). The result is a complete example controller in a <a href=https://github.com/clux/controller-rs/blob/master/Dockerfile>tiny alpine image</a>.</p><h3 id=informer-internals>Informer Internals</h3><p>Informers are just wrappers around a <code>watch</code> call that keeps track of <code>resouceVersion</code>. There&rsquo;s very little inside of it:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#ff79c6>type</span> <span style=color:#50fa7b>WatchQueue</span><span style=color:#ff79c6>&lt;</span>K<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>=</span> VecDeque<span style=color:#ff79c6>&lt;</span>WatchEvent<span style=color:#ff79c6>&lt;</span>K<span style=color:#ff79c6>&gt;&gt;</span>;

<span style=color:#ff79c6>#[derive(Clone)]</span>
<span style=color:#ff79c6>pub</span> <span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>Informer</span><span style=color:#ff79c6>&lt;</span>K<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>where</span>
    K: <span style=color:#8be9fd;font-style:italic>Clone</span> <span style=color:#ff79c6>+</span> DeserializeOwned <span style=color:#ff79c6>+</span> KubeObject
{
    events: <span style=color:#50fa7b>Arc</span><span style=color:#ff79c6>&lt;</span>RwLock<span style=color:#ff79c6>&lt;</span>WatchQueue<span style=color:#ff79c6>&lt;</span>K<span style=color:#ff79c6>&gt;&gt;&gt;</span>,
    version: <span style=color:#50fa7b>Arc</span><span style=color:#ff79c6>&lt;</span>RwLock<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd;font-style:italic>String</span><span style=color:#ff79c6>&gt;&gt;</span>,
    client: <span style=color:#50fa7b>APIClient</span>,
    resource: <span style=color:#50fa7b>RawApi</span>,
    params: <span style=color:#50fa7b>ListParams</span>,
}
</code></pre></div><p>If it wasn&rsquo;t for the extra internal event queue (that users are meant to consume), we could easily have built <code>Reflector</code> on top of <code>Informer</code>. The only main difference is that a <code>Reflector</code> uses the events to maintain an up-to-date <code>BTreeMap</code> rather than handing the events out.</p><p>As with <code>Reflector</code>, we rely on this foundational enum (now public) to encapsulate events:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#ff79c6>#[derive(Deserialize, Serialize, Clone)]</span>
<span style=color:#ff79c6>#[serde(tag = </span><span style=color:#f1fa8c>&#34;type&#34;</span><span style=color:#ff79c6>, content = </span><span style=color:#f1fa8c>&#34;object&#34;</span><span style=color:#ff79c6>, rename_all = </span><span style=color:#f1fa8c>&#34;UPPERCASE&#34;</span><span style=color:#ff79c6>)]</span>
<span style=color:#ff79c6>pub</span> <span style=color:#ff79c6>enum</span> <span style=color:#50fa7b>WatchEvent</span><span style=color:#ff79c6>&lt;</span>K<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>where</span>
    K: <span style=color:#8be9fd;font-style:italic>Clone</span> <span style=color:#ff79c6>+</span> KubeObject
{
    Added(K),
    Modified(K),
    Deleted(K),
    Error(ApiError),
}
</code></pre></div><p>You can compare with <a href=https://github.com/kubernetes/apimachinery/blob/594fc14b6f143d963ea2c8132e09e73fe244b6c9/pkg/apis/meta/v1/watch.go>client-go&rsquo;s WatchEvent</a>.</p><h2 id=drawbacks>Drawbacks</h2><p>So. What&rsquo;s awful?</p><h3 id=everything-is-camelcase>Everything is camelCase!</h3><p>Yeah.. <code>#![allow(non_snake_case)]</code>. It&rsquo;s arguably more helpful to be able to easily cross reference values with the <a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.14>main API docs using Go conventions</a>, than to map them to rust&rsquo;s snake_case preference.</p><p>That said, we currently rely on <code>k8s-openapi</code> (and that crate maps cases..). Do people have strong feelings about this?</p><h3 id=delete-returns-an-either>Delete returns an Either</h3><p>The <code>delete</code> verb akwardly gives you a <code>Status</code> object (sometimes..), so we have to maintain logic to conditionally parse those <code>kind</code> values (where we expect them) into an <a href=https://docs.rs/either/1.5.2/either/enum.Either.html>Either enum</a>. This means users have to <code>map_left</code> to deal with the &ldquo;it&rsquo;s not done yet&rdquo; case, or <code>map_right</code> for the &ldquo;it&rsquo;s done&rdquo; case (<a href=https://github.com/clux/kube-rs/blob/3d1562d5f3e1d06dc599b05cbf6dc44176d710e0/examples/crd_openapi.rs#L40-L52>crd example</a>). Maybe there&rsquo;s a better way to do this. Maybe we need a more semantically correct enum.</p><h3 id=some-resources-are-true-snowflakes>Some resources are true snowflakes</h3><p>While we do handle the <a href=https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/#subresources>generic subresources</a> like <a href=https://github.com/clux/kube-rs/blob/c14ef965af7d68d37e6acb343d02ef5841c5bf37/src/api/typed.rs#L126-L142>Scale</a>, some objects has a bunch of special subresources associated with them.</p><p>The most common example is <code>v1Pod</code>, which has <code>pods/attach</code>, <code>pods/portforward</code>, <code>pods/eviction</code>, <code>pods/exec</code>, <code>pods/log</code>, to name a few. Similarly, we can <code>drain</code> or <code>cordon</code> a <code>v1Node</code>. So we clearly have non-standard verbs and non-standard nouns.</p><p>This is probably solveable with some blunt <code>generic_verb_noun</code> hammer on <code>RawApi</code> (<a href=https://github.com/clux/kube-rs/issues/30>see #30</a>) for our supported apis.</p><p>It clearly breaks the generic model somewhat, but thankfully only in the areas you&rsquo;d expect it to break.</p><h3 id=not-everything-follows-the-spec-status-model>Not everything follows the Spec + Status model</h3><p>You might think these exceptions make up a short and insignificant list of legacy objects, but look at this subset:</p><ul><li><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.14/#rolebinding-v1-rbac-authorization-k8s-io>RoleBinding</a> with <code>subjects</code> + <code>roleRef</code></li><li><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.14/#role-v1-rbac-authorization-k8s-io>Role</a> with a <code>rules</code> vec</li><li><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.14/#configmap-v1-core>ConfigMap</a> - with <code>data</code> + <code>binaryData</code></li><li><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.14/#endpoints-v1-core>Endpoints</a> - with a <code>subsets</code> vector</li><li><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.14/#event-v1-core>Event</a> - with 17 random fields!</li><li><a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.14/#serviceaccount-v1-core>ServiceAccount</a> - <code>secrets</code> vector + misc fields</li></ul><p>And that was only like 20 minutes in the API docs. Long story short, <a href=https://github.com/clux/kube-rs/issues/35>we eventually</a> stopped relying on <code>Object&lt;P, U&gt;</code> everywhere in favour of <code>KubeObject</code>. This meant we could deal with these special objects in <a href=https://github.com/clux/kube-rs/blob/0b0ed4d2f035cf9e455f1ad8ae346cf87fc20cac/src/api/snowflake.rs#L15-L62>mod snowflake</a>, without feeling too dirty about it..</p><h3 id=remaining-toil>Remaining toil</h3><p>While many of the remaining tasks are not too difficult, there are quite a few of them:</p><ul><li><a href=https://github.com/clux/kube-rs/issues/25>integrating all the remaining native objects</a> (can be done one-by-one)</li><li>support more than <a href=https://github.com/clux/kube-rs/issues/24><code>patch --type=merge</code></a></li><li><a href=https://docs.rs/backoff/0.1.5/backoff/>backoff crate</a> use for <a href=https://github.com/clux/kube-rs/issues/34>exponential backoff</a> =&gt; less cascady network failures</li><li>support <a href=https://github.com/clux/kube-rs/issues/19>local kubeconfig auth providers</a></li></ul><p>The last one is a huge faff, with differences across providers, all in the name of avoiding <a href=https://clux.github.io/probes/post/2019-03-31-impersonating-kube-accounts>impersonating a service accounts when developing locally</a>.</p><h2 id=help>Help</h2><p>The foundation is now there, in the sense that we feel like we&rsquo;re covering most of the theoretical bases (..that we could think of).</p><p><a href="https://github.com/clux/kube-rs/issues?q=is%3Aissue+is%3Aopen+label%3A%22help+wanted%22">Help with examples/object support/stuff listed above</a> would be greatly appreciated at this point. Hopefully, this library will end up being useful to some. With some familiarity with rust, the generated <a href=https://clux.github.io/kube-rs/kube/api/index.html>docs</a> + <a href=https://github.com/clux/kube-rs/tree/master/examples>examples</a> should get you started.</p><p>Anyway, if you do end up using this, and you work in the open, <a href=https://github.com/clux/kube-rs/issues/12>please let us link to your controllers for examples</a>.</p><p>&lt;/üêÇüíà&gt;</p><div class=blog-tags><a href=https://clux.github.io/probes//tags/rust/>rust</a>&nbsp;
<a href=https://clux.github.io/probes//tags/kubernetes/>kubernetes</a>&nbsp;</div><h4 class=see-also>See also</h4><ul><li><a href=https://clux.github.io/probes/post/2019-04-29-rust-on-kubernetes/>Kubernetes operators in rust</a></li><li><a href=https://clux.github.io/probes/post/2018-12-15-config-management-in-rust/>Config management in rust</a></li><li><a href=https://clux.github.io/probes/post/2019-03-31-impersonating-kube-accounts/>Impersonating kube service accounts</a></li></ul></article><ul class="pager blog-pager"><li class=previous><a href=https://clux.github.io/probes/post/2019-04-29-rust-on-kubernetes/ data-toggle=tooltip data-placement=top title="Kubernetes operators in rust">&larr; Previous Post</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=mailto:sszynrae@gmail.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/clux title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://twitter.com/sszynrae title=Twitter><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://reddit.com/u/clux title=Reddit><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-reddit-alien fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/eirik-albrigtsen-b279863a title=LinkedIn><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://www.youtube.com/channel/UCLpykMxkxuPUR9CciheipZg title=Youtube><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-youtube fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted">clux
&nbsp;&bull;&nbsp;&copy;
2019
&nbsp;&bull;&nbsp;
<a href=https://clux.github.io/probes/>probes</a></p><p class="credits theme-by text-muted"><a href=http://gohugo.io>Hugo v0.52</a> powered &nbsp;&bull;&nbsp; Theme by <a href=http://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a> adapted to <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a></p></div></div></div></footer><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://clux.github.io/probes/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://clux.github.io/probes/js/load-photoswipe.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script><script>renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:true},{left:"$",right:"$",display:false},]})</script></body></html>